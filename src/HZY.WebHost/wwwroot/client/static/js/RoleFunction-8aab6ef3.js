var U=Object.defineProperty,E=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var F=(e,t,a)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,g=(e,t)=>{for(var a in t||(t={}))S.call(t,a)&&F(e,a,t[a]);if(k)for(var a of k(t))V.call(t,a)&&F(e,a,t[a]);return e},b=(e,t)=>E(e,L(t));import{p as C,d as z,_ as q,t as I}from"./index-28e59af6.js";import{d as D,k as H,r as J,t as O,b as r,o as m,c as f,h as d,s as h,q as T,u as y,x,m as M,p as W,y as _,F as Y,J as j}from"./vendor-621951b9.js";const v="admin/SysRoleMenuFunction";var R={findList(e,t,a={}){return C(`${v}/findList/${e}/${t}`,a,!1)},saveForm(e){return C(`${v}/saveForm`,e)},getRoleMenuFunctionByRoleId(e){return z(`${v}/getRoleMenuFunctionByRoleId/${e}`)}};const G=D({name:"RoleFunctionCom",setup(){const e=H({roleId:"",data:[],loading:!1,visible:!1}),t=J(null),a={getRoleMenuFunctionTree(){e.loading=!0,R.getRoleMenuFunctionByRoleId(e.roleId).then(l=>{e.loading=!1;let n=l.data;e.data=n,j(()=>{for(var c=0;c<e.data.length;c++){var i=e.data[c];if(i.menuFunctions.length>0){var u=i.levelCode.substr(0,i.levelCode.lastIndexOf("."));t.value.setTreeExpand(e.data.filter(p=>p.levelCode==u),!0)}}})})},save(){for(var l=e.data.filter(u=>u.menuFunctions.length>0),n=[],c=0;c<l.length;c++){var i=l[c];n.push({roleId:e.roleId,menuId:i.id,menuFunctionIdList:i.checkedMenuFunctionIds})}R.saveForm(n).then(u=>{if(u.code!=1)return I.message("\u4FDD\u5B58\u5931\u8D25!","\u9519\u8BEF");a.getRoleMenuFunctionTree(),I.message("\u4FDD\u5B58\u6210\u529F!","\u6210\u529F")})},onChangeCheckbox({values:l,row:n}){n.indeterminate=!!l.length&&l.length<n.menuFunctions.length,n.checkAll=l.length===n.menuFunctions.length},openWindow({visible:l,key:n}){e.visible=l,e.roleId=n,a.getRoleMenuFunctionTree()},setAllTreeExpand(){t.value.setAllTreeExpand(!0)},onCheckAllChange(l,n){l.target.checked?(n.checkedMenuFunctionIds=n.menuFunctions.map(c=>c.id),n.indeterminate=n.checkedMenuFunctionIds.length>0&&n.checkedMenuFunctionIds.length<n.menuFunctions.length,n.checkAll=n.checkedMenuFunctionIds.length===n.menuFunctions.length):(n.checkedMenuFunctionIds=[],n.indeterminate=!1)}};return b(g(g({},O(e)),a),{refTable:t})}}),K=T("span",{class:"mr-15"},"\u89D2\u8272\u529F\u80FD\u8BBE\u7F6E",-1),P=_("\u4FDD\u5B58/\u63D0\u4EA4"),Q={class:"mr-15"},X=_(" \u5168\u9009 ");function Z(e,t,a,l,n,c){const i=r("a-button"),u=r("a-checkbox"),p=r("vxe-column"),$=r("a-checkbox-group"),A=r("vxe-table"),B=r("a-spin"),N=r("a-modal");return m(),f(N,{visible:e.visible,"onUpdate:visible":t[0]||(t[0]=o=>e.visible=o),centered:"",width:"1200px",bodyStyle:{overflowY:"auto",height:"calc(100vh - 100px)"},footer:null},{title:d(()=>[K,h(i,{type:"primary",onClick:e.save},{default:d(()=>[P]),_:1},8,["onClick"])]),default:d(()=>[h(B,{spinning:e.loading},{default:d(()=>[h(A,{ref:"refTable",resizable:"",data:e.data,"row-config":{isHover:!0},"tree-config":{transform:!0,rowField:"id",parentField:"parentId"},size:"small"},{default:d(()=>[h(p,{field:"name",title:"\u83DC\u5355\u540D\u79F0","tree-node":"",width:"250"},{default:d(({row:o})=>[T("span",Q,y(o.name),1),o.menuFunctions.length>0?(m(),f(u,{key:0,checked:o.checkAll,"onUpdate:checked":s=>o.checkAll=s,indeterminate:o.indeterminate,onChange:s=>e.onCheckAllChange(s,o)},{default:d(()=>[X]),_:2},1032,["checked","onUpdate:checked","indeterminate","onChange"])):x("",!0)]),_:1}),h(p,{field:"id",title:"\u6743\u9650"},{default:d(({row:o})=>[o.menuFunctions.length>0?(m(),f($,{key:0,style:{display:"block"},value:o.checkedMenuFunctionIds,"onUpdate:value":s=>o.checkedMenuFunctionIds=s,onChange:s=>e.onChangeCheckbox({values:s,row:o})},{default:d(()=>[(m(!0),M(Y,null,W(o.menuFunctions,s=>(m(),M("span",{key:s.id,class:"mr-15"},[h(u,{value:s.id},{default:d(()=>[_(y(s.label),1)]),_:2},1032,["value"])]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):x("",!0)]),_:1})]),_:1},8,["data"])]),_:1},8,["spinning"])]),_:1},8,["visible","bodyStyle"])}var te=q(G,[["render",Z]]);export{te as default};
