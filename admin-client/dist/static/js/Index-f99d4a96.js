import{d as K,r as q,R as H,b as x,e as Q,f as r,o as l,l as m,w as a,a as n,u as c,j as u,z as f,c as v,D,t as W,G as O,S as X,g as j,T,L as Y,i as Z}from"./index-2f681d41.js";import{_ as g}from"./AppIcon.vue_vue_type_script_setup_true_lang-c9c34753.js";import{M as C,_ as ee}from"./Info.vue_vue_type_script_setup_true_lang-e2ed94aa.js";import{_ as te}from"./PageContainer.vue_vue_type_script_setup_true_lang-3d3dfadb.js";import{_ as ae}from"./TableCurd.vue_vue_type_script_setup_true_lang-7162f1fc.js";import"./WangEditor.vue_vue_type_script_setup_true_lang-0599945d.js";import"./FindBack-a05dc669.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./Index.vue_vue_type_script_setup_true_lang-7b65d98a.js";import"./Info.vue_vue_type_script_setup_true_lang-f2ff642e.js";import"./SysOrganizationService-bde1bf3b.js";const oe={key:0},ne={key:1},se=["src"],re=["onClick"],le=["onClick"],ie=j("a",{class:"text-danger"},"删除",-1),xe=K({name:"base_member",__name:"Index",setup(de){const t=q({search:{state:!1,vm:{name:void 0},sort:[]},loading:!1,page:1,size:10,total:100,columns:[],data:[]}),d=H(),b=x(),h=x(),S=x();Q(()=>{p()});async function p(){try{t.loading=!0;const s=await C.findList(t.page,t.size,t.search.vm,t.search.sort);if(t.loading=!1,s.code!=1)return;t.page=s.data.page,t.size=s.data.size,t.total=s.data.total,t.columns=s.data.columns,t.data=s.data.dataSource}catch{t.loading=!1}}async function w(s){var k;let o=[];if(s?o.push(s):o=((k=b.value)==null?void 0:k.getSelectedRowKeys())??[],o.length==0)return T.message.error("请选择要删除的行!");try{t.loading=!0;const y=await C.deleteList(o);if(t.loading=!1,y.code!=1)return;T.message.success("删除成功!"),p()}catch{t.loading=!1}}function B(){C.exportExcel(t.search.vm,t.search.sort)}function E(s){if(s){var o=JSON.parse(s);return Y.domainServerApi+(o.length>0?o[0].url:"")}}function F(s){Z.push(`/base/member/details/${s.id}/${s.name}`)}return(s,o)=>{const k=r("a-input"),y=r("a-form-item"),$=r("a-col"),_=r("a-button"),U=r("a-space"),V=r("a-row"),A=r("a-form"),z=r("a-popconfirm"),I=r("a-menu-item"),M=r("a-menu"),P=r("a-dropdown"),R=r("a-checkbox"),G=r("a-popover"),N=r("a-table-column"),L=r("a-divider");return l(),m(te,null,{default:a(()=>[n(ae,{ref_key:"refTableCurd",ref:b,config:t,onChange:o[7]||(o[7]=e=>{t.page=e.pagination.current??1,t.size=e.pagination.pageSize??t.size,t.search.sort=e.sorter instanceof Array?[...e.sorter]:[e.sorter],p()}),onShowSizeChange:o[8]||(o[8]=({current:e,size:i})=>{t.page=e==0?1:e,t.size=i,p()})},{search:a(()=>[c(d).search?(l(),m(A,{key:0,ref_key:"refSearchForm",ref:S,model:t.search.vm},{default:a(()=>[n(V,{gutter:[16,0]},{default:a(()=>[n($,{xs:24,sm:12,md:8,lg:6,xl:6},{default:a(()=>[n(y,{class:"mb-0",name:"name",label:"名称"},{default:a(()=>[n(k,{value:t.search.vm.name,"onUpdate:value":o[0]||(o[0]=e=>t.search.vm.name=e),placeholder:"名称"},null,8,["value"])]),_:1})]),_:1}),n($,{xs:24,sm:12,md:8,lg:6,xl:6,class:"text-right"},{default:a(()=>[n(U,{size:8},{default:a(()=>[n(_,{onClick:o[1]||(o[1]=e=>{var i;t.page=1,(i=S.value)==null||i.resetFields(),p()})},{default:a(()=>[u(" 重置 ")]),_:1}),n(_,{type:"primary",onClick:o[2]||(o[2]=e=>{t.page=1,p()})},{default:a(()=>[u(" 查询 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])):f("",!0)]),"toolbar-left":a(()=>[c(d).search?(l(),m(_,{key:0,onClick:o[3]||(o[3]=e=>t.search.state=!t.search.state)},{default:a(()=>[t.search.state?(l(),v("div",oe,[n(g,{name:"UpOutlined"}),u("  收起")])):(l(),v("div",ne,[n(g,{name:"DownOutlined"}),u("  展开")]))]),_:1})):f("",!0),c(d).insert?(l(),m(_,{key:1,type:"primary",onClick:o[4]||(o[4]=()=>{var e;return(e=h.value)==null?void 0:e.open()})},{icon:a(()=>[n(g,{name:"PlusOutlined"})]),default:a(()=>[u(" 新建 ")]),_:1})):f("",!0),c(d).delete?(l(),m(z,{key:2,title:"您确定要删除?",onConfirm:o[5]||(o[5]=e=>w()),okText:"确定",cancelText:"取消"},{default:a(()=>[n(_,{type:"primary",danger:""},{icon:a(()=>[n(g,{name:"DeleteOutlined"})]),default:a(()=>[u(" 批量删除 ")]),_:1})]),_:1})):f("",!0)]),"toolbar-right":a(()=>[n(P,null,{overlay:a(()=>[n(M,null,{default:a(()=>[n(I,{key:"1",onClick:o[6]||(o[6]=e=>B())},{default:a(()=>[u("导出 Excel")]),_:1})]),_:1})]),default:a(()=>[n(_,null,{default:a(()=>[u(" 更多 "),n(g,{name:"ellipsis-outlined"})]),_:1})]),_:1}),n(G,null,{content:a(()=>[(l(!0),v(O,null,D(t.columns.filter(e=>e.fieldName.substr(0,1)!="_"),e=>(l(),v("div",null,[n(R,{checked:e.show,"onUpdate:checked":i=>e.show=i},{default:a(()=>[u(W(e.title),1)]),_:2},1032,["checked","onUpdate:checked"])]))),256))]),default:a(()=>[n(_,{type:"text"},{icon:a(()=>[n(g,{name:"setting-outlined"})]),_:1})]),_:1})]),"table-col":a(()=>[(l(!0),v(O,null,D(t.columns.filter(e=>e.fieldName!=="id"&&e.show),(e,i)=>(l(),m(N,{key:e.fieldName,title:e.title,"data-index":e.fieldName,sorter:e.sort?{multiple:i+1}:!1},X({_:2},[e.fieldName=="photo"?{name:"default",fn:a(({record:J})=>[j("img",{src:E(J.photo),width:"35",height:"35"},null,8,se)]),key:"0"}:void 0]),1032,["title","data-index","sorter"]))),128)),c(d).update||c(d).delete?(l(),m(N,{key:0,title:"操作","data-index":"id"},{default:a(({record:e})=>[c(d).update?(l(),v("a",{key:0,href:"javascript:void(0)",onClick:i=>F(e)},"详情",8,re)):f("",!0),n(L,{type:"vertical"}),c(d).update?(l(),v("a",{key:1,href:"javascript:;",onClick:()=>{var i;return(i=h.value)==null?void 0:i.open(e.id)}},"编辑",8,le)):f("",!0),n(L,{type:"vertical"}),c(d).delete?(l(),m(z,{key:2,title:"您确定要删除?",onConfirm:i=>w(e.id),okText:"确定",cancelText:"取消"},{default:a(()=>[ie]),_:2},1032,["onConfirm"])):f("",!0)]),_:1})):f("",!0)]),_:1},8,["config"]),n(ee,{ref_key:"refInfo",ref:h,onSuccess:()=>p()},null,8,["onSuccess"])]),_:1})}}});export{xe as default};
