var V=Object.defineProperty;var E=(m,s,t)=>s in m?V(m,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[s]=t;var N=(m,s,t)=>(E(m,typeof s!="symbol"?s+"":s,t),t);import{_ as g}from"./AppIcon.vue_vue_type_script_setup_true_lang-5572fb54.js";import{H as C,d as H,r as R,b as U,a7 as K,f as i,o as u,l as x,w as a,a as e,i as d,c as T,s as M,t as j,F as q,g as A,T as z}from"./index-235b159a.js";import{_ as G}from"./TableCurd.vue_vue_type_script_setup_true_lang-349ec67c.js";class y{static findList(s,t,h={},b=[]){return C.post(`${this.urlPrefix}/findList`,{page:s,size:t,search:h,searchSort:b})}static deleteList(s){return C.post(`${this.urlPrefix}/deleteList`,{data:s})}static synchronization(s){return C.post(`${this.urlPrefix}/synchronization/${s}`)}static change(s){return C.post(`${this.urlPrefix}/change`,s)}}N(y,"urlPrefix","/api/v1/admin/LowCodeTableInfo");const J={key:0},Q={key:1},W=A("a",{class:"text-danger"},"删除",-1),te=H({__name:"Columns",props:{rowData:null},setup(m){const s=m,t=R({search:{state:!1,vm:{Low_Code_TableId:void 0,columnName:void 0,describe:void 0},sort:[]},loading:!1,page:1,size:100,total:100,columns:[],data:[]}),h=U(),b=U();K(()=>{s.rowData&&f()},s.rowData);async function f(){t.loading=!0,t.search.vm.Low_Code_TableId=s.rowData.id;const l=await y.findList(t.page,t.size,t.search.vm,t.search.sort);t.loading=!1,l.code==1&&(t.page=l.data.page,t.size=l.data.size,t.total=l.data.total,t.columns=l.data.columns,t.data=l.data.dataSource)}async function L(l){var v;let o=[];if(l?o.push(l):o=((v=h.value)==null?void 0:v.getSelectedRowKeys())??[],o.length==0)return z.message.error("请选择要删除的行!");t.loading=!0;const _=await y.deleteList(o);t.loading=!1,_.code==1&&(z.message.success("删除成功!"),f())}function D(){y.synchronization(s.rowData.id).then(l=>{z.message.success("同步成功!"),f()})}function P(){y.change(t.data).then(l=>{z.message.success("数据变更成功!"),f()})}return(l,o)=>{const _=i("a-input"),v=i("a-form-item"),$=i("a-col"),p=i("a-button"),S=i("a-space"),F=i("a-row"),I=i("a-form"),k=i("a-popconfirm"),O=i("a-checkbox"),B=i("a-popover"),r=i("a-table-column"),w=i("a-tag");return u(),x(G,{ref_key:"refTableCurd",ref:h,config:t,onChange:o[8]||(o[8]=n=>{t.page=n.pagination.current??1,t.size=n.pagination.pageSize??t.size,f()}),onShowSizeChange:o[9]||(o[9]=({current:n,size:c})=>{t.page=n==0?1:n,t.size=c,f()})},{search:a(()=>[e(I,{ref_key:"refSearchForm",ref:b,model:t.search.vm},{default:a(()=>[e(F,{gutter:[16,0]},{default:a(()=>[e($,{xs:24,sm:12,md:8,lg:6,xl:6},{default:a(()=>[e(v,{class:"mb-0",name:"columnName",label:"列名称"},{default:a(()=>[e(_,{value:t.search.vm.columnName,"onUpdate:value":o[0]||(o[0]=n=>t.search.vm.columnName=n),placeholder:"列名称"},null,8,["value"])]),_:1})]),_:1}),e($,{xs:24,sm:12,md:8,lg:6,xl:6},{default:a(()=>[e(v,{class:"mb-0",name:"describe",label:"显示名称"},{default:a(()=>[e(_,{value:t.search.vm.describe,"onUpdate:value":o[1]||(o[1]=n=>t.search.vm.describe=n),placeholder:"显示名称"},null,8,["value"])]),_:1})]),_:1}),e($,{xs:24,sm:12,md:8,lg:6,xl:6,class:"text-right"},{default:a(()=>[e(S,{size:8},{default:a(()=>[e(p,{onClick:o[2]||(o[2]=n=>{var c;t.page=1,(c=b.value)==null||c.resetFields(),f()})},{default:a(()=>[d(" 重置 ")]),_:1}),e(p,{type:"primary",onClick:o[3]||(o[3]=n=>{t.page=1,f()})},{default:a(()=>[d(" 查询 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),"toolbar-left":a(()=>[e(p,{onClick:o[4]||(o[4]=n=>t.search.state=!t.search.state)},{default:a(()=>[t.search.state?(u(),T("div",J,[e(g,{name:"UpOutlined"}),d("  收起")])):(u(),T("div",Q,[e(g,{name:"DownOutlined"}),d("  展开")]))]),_:1}),e(k,{title:"您确定要更新表吗?可能会导致数据丢失",onConfirm:o[5]||(o[5]=n=>D()),okText:"确定",cancelText:"取消"},{default:a(()=>[e(p,{type:"primary"},{icon:a(()=>[e(g,{name:"ReloadOutlined"})]),default:a(()=>[d(" 同步字段 ")]),_:1})]),_:1}),e(k,{title:"您确定要提交更改?",onConfirm:o[6]||(o[6]=n=>P()),okText:"确定",cancelText:"取消"},{default:a(()=>[e(p,{type:"primary"},{icon:a(()=>[e(g,{name:"PlusOutlined"})]),default:a(()=>[d(" 提交更改 ")]),_:1})]),_:1}),e(k,{title:"您确定要删除?",onConfirm:o[7]||(o[7]=n=>L()),okText:"确定",cancelText:"取消"},{default:a(()=>[e(p,{type:"primary",danger:""},{icon:a(()=>[e(g,{name:"DeleteOutlined"})]),default:a(()=>[d(" 批量删除 ")]),_:1})]),_:1})]),"toolbar-right":a(()=>[e(B,null,{content:a(()=>[(u(!0),T(q,null,M(t.columns.filter(n=>n.fieldName.substr(0,1)!="_"),n=>(u(),T("div",null,[e(O,{checked:n.show,"onUpdate:checked":c=>n.show=c},{default:a(()=>[d(j(n.title),1)]),_:2},1032,["checked","onUpdate:checked"])]))),256))]),default:a(()=>[e(p,{type:"text"},{icon:a(()=>[e(g,{name:"setting-outlined"})]),_:1})]),_:1})]),"table-col":a(()=>[e(r,{title:"列名称","data-index":"columnName"}),e(r,{title:"数据库类型","data-index":"databaseColumnType"}),e(r,{title:"C#字段名称","data-index":"csField"}),e(r,{title:"C#数据类型","data-index":"csType"}),e(r,{title:"是否主键","data-index":"isPrimary"},{default:a(({record:n})=>[n.isPrimary?(u(),x(w,{key:0,color:"success"},{default:a(()=>[d("是")]),_:1})):(u(),x(w,{key:1,color:"default"},{default:a(()=>[d("否")]),_:1}))]),_:1}),e(r,{title:"是否自增","data-index":"isIdentity"},{default:a(({record:n})=>[n.isIdentity?(u(),x(w,{key:0,color:"success"},{default:a(()=>[d("是")]),_:1})):(u(),x(w,{key:1,color:"default"},{default:a(()=>[d("否")]),_:1}))]),_:1}),e(r,{title:"显示名称","data-index":"displayName"},{default:a(({record:n})=>[e(_,{value:n.displayName,"onUpdate:value":c=>n.displayName=c},null,8,["value","onUpdate:value"])]),_:1}),e(r,{title:"列描述","data-index":"describe"},{default:a(({record:n})=>[e(_,{value:n.describe,"onUpdate:value":c=>n.describe=c},null,8,["value","onUpdate:value"])]),_:1}),e(r,{title:"更新时间","data-index":"lastModificationTime",width:"120px"}),e(r,{title:"创建时间","data-index":"creationTime",width:"120px"}),e(r,{title:"操作","data-index":"id"},{default:a(({record:n})=>[e(k,{title:"您确定要删除?",onConfirm:c=>L(n.id),okText:"确定",cancelText:"取消"},{default:a(()=>[W]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["config"])}}});export{te as _};
