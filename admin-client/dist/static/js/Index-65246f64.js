var I=Object.defineProperty;var M=(s,o,n)=>o in s?I(s,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[o]=n;var y=(s,o,n)=>(M(s,typeof o!="symbol"?o+"":o,n),n);import{_ as S}from"./PageContainer.vue_vue_type_script_setup_true_lang-4a22be12.js";import{H as f,d as b,b as h,e as F,aa as T,f as _,o as B,l as N,w as a,a as l,g as t,i as d,t as i,p as E,k as P}from"./index-1d3290fc.js";import{_ as $}from"./_plugin-vue_export-helper-c27b6911.js";import"./AppIcon.vue_vue_type_script_setup_true_lang-5c9d9d70.js";class m{static getEFCoreMonitorContext(){return f.post(`${this.urlPrefix}/GetEFCoreMonitorContext/`)}static getTimeConsumingRanking(){return f.post(`${this.urlPrefix}/GetTimeConsumingRanking/`)}static getNewest(){return f.post(`${this.urlPrefix}/GetNewest/`)}}y(m,"urlPrefix","/api/v1/admin/MonitorEFCore");const e=s=>(E("data-v-48d92d4a"),s=s(),P(),s),q=e(()=>t("div",null,"数据连接打开",-1)),D=e(()=>t("span",null,"次",-1)),G=e(()=>t("div",null,"数据连接断开",-1)),R=e(()=>t("span",null,"次",-1)),V=e(()=>t("div",null,"连接失败",-1)),H=e(()=>t("span",null,"次",-1)),z=e(()=>t("div",null,"创建命令",-1)),U=e(()=>t("span",null,"次",-1)),j=e(()=>t("div",null,"执行命令",-1)),A=e(()=>t("span",null,"次",-1)),J=e(()=>t("div",null,"命令执行失败",-1)),K=e(()=>t("span",null,"次",-1)),L=e(()=>t("div",null,"创建事务",-1)),O=e(()=>t("span",null,"次",-1)),Q=e(()=>t("div",null,"提交事务",-1)),W=e(()=>t("span",null,"次",-1)),X=e(()=>t("div",null,"回滚事务",-1)),Y=e(()=>t("span",null,"次",-1)),Z=e(()=>t("div",null,"事务失败",-1)),tt=e(()=>t("span",null,"次",-1)),et={class:"text-danger"},nt=b({name:"monitor_efcore"}),lt=b({...nt,setup(s){const o=h(!1),n=h({}),v=h();let C=null;F(()=>{x(),C=setInterval(()=>{x()},15*1e3)}),T(()=>{clearInterval(C)});async function x(){o.value=!0;const c=await m.getEFCoreMonitorContext();if(o.value=!1,c.code!=1)return;n.value=c.data,o.value=!0;const r=await m.getTimeConsumingRanking();o.value=!1,r.code==1&&(v.value=r.data)}return(c,r)=>{const u=_("a-card-grid"),g=_("a-card"),p=_("a-table-column"),k=_("a-table");return B(),N(S,null,{default:a(()=>[l(g,{title:!1,bodyStyle:{display:"flex"}},{default:a(()=>[l(u,null,{default:a(()=>[q,t("h1",null,[d(i(n.value.openDbConnectionCount??0)+" ",1),D])]),_:1}),l(u,null,{default:a(()=>[G,t("h1",null,[d(i(n.value.closeDbConnectionCount??0)+" ",1),R])]),_:1}),l(u,null,{default:a(()=>[V,t("h1",null,[d(i(n.value.connectionFailedCount??0)+" ",1),H])]),_:1}),l(u,null,{default:a(()=>[z,t("h1",null,[d(i(n.value.createCommandCount??0)+" ",1),U])]),_:1}),l(u,null,{default:a(()=>[j,t("h1",null,[d(i(n.value.executeCommandCount??0)+" ",1),A])]),_:1})]),_:1}),l(g,{title:!1,bodyStyle:{display:"flex"},style:{"border-top":"0"}},{default:a(()=>[l(u,null,{default:a(()=>[J,t("h1",null,[d(i(n.value.commandFailedCount??0)+" ",1),K])]),_:1}),l(u,null,{default:a(()=>[L,t("h1",null,[d(i(n.value.createTransactionCount??0)+" ",1),O])]),_:1}),l(u,null,{default:a(()=>[Q,t("h1",null,[d(i(n.value.submitTransactionCount??0)+" ",1),W])]),_:1}),l(u,null,{default:a(()=>[X,t("h1",null,[d(i(n.value.rollBackCount??0)+" ",1),Y])]),_:1}),l(u,null,{default:a(()=>[Z,t("h1",null,[d(i(n.value.transactionFailedCount??0)+" ",1),tt])]),_:1})]),_:1}),l(k,{"data-source":v.value,size:"middle",pagination:!1},{default:a(()=>[l(p,{key:"sql",title:"Sql Script","data-index":"sql"}),l(p,{key:"elapsedMilliseconds",title:"耗时","data-index":"elapsedMilliseconds",width:100},{default:a(({record:w})=>[t("span",et,i(w.elapsedMilliseconds)+" 毫秒",1)]),_:1}),l(p,{key:"time",title:"执行时间","data-index":"time",width:200})]),_:1},8,["data-source"])]),_:1})}}});const dt=$(lt,[["__scopeId","data-v-48d92d4a"]]);export{dt as default};
