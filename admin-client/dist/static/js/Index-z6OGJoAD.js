import{T as y}from"./TimedTaskService-2_JrkzO6.js";import{d as J,b as k,r as A,e as Q,a7 as X,f as o,o as i,l as d,w as e,a as t,j as s,B as v,g as U,c as Y,M as Z,t as T,T as b}from"./index-C9oHGpmd.js";import{_ as ee}from"./Info.vue_vue_type_script_setup_true_lang-nfblk8YG.js";import{_ as te}from"./Log.vue_vue_type_script_setup_true_lang-49Alj6hi.js";import{_ as ae}from"./PageContainer.vue_vue_type_script_setup_true_lang-w--qcJ6v.js";import"./GenerateCron.vue_vue_type_script_setup_true_lang-HSsOihAf.js";import"./Index-NNh0J9ij.js";import"./_plugin-vue_export-helper-x3n3nnut.js";import"./AppIcon.vue_vue_type_script_setup_true_lang-o_ph5tPH.js";const ne={class:"mt-24"},oe=U("span",{style:{color:"red"}},"更多",-1),me=J({__name:"Index",setup(se){const V=[{title:"分组",dataIndex:"groupName",align:"center",width:200,ellipsis:!0,fixed:"left"},{title:"作业名称",dataIndex:"name",align:"center",width:300,ellipsis:!0,fixed:"left"},{title:"任务类型",dataIndex:"type",align:"center",width:100},{title:"间隔表达式",dataIndex:"cron",align:"center",width:120},{title:"最后执行时间",dataIndex:"executeTime",align:"center",width:150},{title:"描述",dataIndex:"remark",align:"center",ellipsis:!0},{title:"状态",dataIndex:"state",align:"center",width:80,fixed:"right"},{title:"操作",dataIndex:"id",align:"center",width:200,fixed:"right"}],I=k(""),c=k(!1),w=k([]);let K;const S=k(),L=k(),f=A({selectedRowKeys:[],refresh:!1});Q(()=>{_(),K=setInterval(()=>{f.refresh&&_()},30*1e3)}),X(()=>{clearInterval(K)});const $=l=>{console.log("selectedRowKeys changed: ",l),f.selectedRowKeys=l};async function _(){c.value=!0;const l=await y.findList(I.value);c.value=!1,l.code==200&&(w.value=l.data)}async function B(l){let a=[];if(l==null){if(f.selectedRowKeys.length==0)return b.message.warning("请选择要删除的数据!");a.push(...f.selectedRowKeys)}else a.push(l);c.value=!0;const u=await y.deleteList(a);c.value=!1,u.code==200&&(b.message.success("删除成功!"),await _())}async function q(l,a){if(l==1){c.value=!0;const u=await y.run([a]);if(c.value=!1,u.code!=200){w.value.find(g=>g.id==a).state=0;return}}else{c.value=!0;const u=await y.close([a]);if(c.value=!1,u.code!=200){w.value.find(g=>g.id==a).state=0;return}}b.message.success("执行成功!"),await _()}async function H(){c.value=!0;const l=await y.scanTask();if(c.value=!1,console.log(l),l.code==200)return await _(),b.message.success("扫描成功!")}return(l,a)=>{const u=o("a-button"),g=o("ScanOutlined"),N=o("a-popconfirm"),M=o("a-space"),h=o("a-col"),W=o("a-checkbox"),j=o("a-input-search"),D=o("a-row"),O=o("a-card"),p=o("a-tag"),P=o("a-switch"),z=o("a-divider"),R=o("a-typography-link"),x=o("a-descriptions-item"),E=o("a-descriptions"),F=o("a-table"),G=o("a-spin");return i(),d(ae,null,{default:e(()=>[t(G,{spinning:c.value},{default:e(()=>[t(O,null,{default:e(()=>[t(D,null,{default:e(()=>[t(h,{xs:24,sm:24,md:12,lg:6,xl:6},{default:e(()=>[t(M,null,{default:e(()=>[t(u,{type:"primary",onClick:a[0]||(a[0]=()=>{var n;return(n=S.value)==null?void 0:n.openWindow()})},{default:e(()=>[s("新建")]),_:1}),t(u,{type:"primary",onClick:H},{icon:e(()=>[t(g)]),default:e(()=>[s(" 恢复本地任务 ")]),_:1}),t(N,{title:"确定要删除?",onConfirm:a[1]||(a[1]=n=>B(void 0))},{default:e(()=>[f.selectedRowKeys.length>0?(i(),d(u,{key:0,type:"primary",danger:""},{default:e(()=>[s("批量删除")]),_:1})):v("",!0)]),_:1})]),_:1})]),_:1}),t(h,{xs:24,sm:24,md:12,lg:6,xl:6}),t(h,{xs:24,sm:24,md:12,lg:6,xl:6},{default:e(()=>[t(W,{checked:f.refresh,"onUpdate:checked":a[2]||(a[2]=n=>f.refresh=n)},{default:e(()=>[s("30s刷新")]),_:1},8,["checked"])]),_:1}),t(h,{xs:24,sm:24,md:12,lg:6,xl:6,class:"text-right"},{default:e(()=>[t(j,{value:I.value,"onUpdate:value":a[3]||(a[3]=n=>I.value=n),placeholder:"请输入",onSearch:a[4]||(a[4]=()=>_())},null,8,["value"])]),_:1})]),_:1})]),_:1}),U("div",ne,[t(F,{"data-source":w.value,columns:V,size:"small","expand-column-width":50,"row-key":"id",pagination:!1,scroll:{x:"calc(100vw - 100px)"},"row-selection":{selectedRowKeys:f.selectedRowKeys,onChange:$}},{bodyCell:e(({column:n,text:C,record:m})=>[n.dataIndex==="type"?(i(),Y(Z,{key:0},[C==3?(i(),d(p,{key:0,color:"#1677ff"},{default:e(()=>[s("本地同步任务")]),_:1})):v("",!0),C==4?(i(),d(p,{key:1,color:"#a0d911"},{default:e(()=>[s("本地异步任务")]),_:1})):C==5?(i(),d(p,{key:2,color:"#722ed1"},{default:e(()=>[s("Http同步任务")]),_:1})):C==6?(i(),d(p,{key:3,color:"#eb2f96"},{default:e(()=>[s("Http异步任务")]),_:1})):v("",!0)],64)):n.dataIndex==="state"?(i(),d(P,{key:1,checked:m.state,"onUpdate:checked":r=>m.state=r,onChange:r=>q(r,m.id)},null,8,["checked","onUpdate:checked","onChange"])):n.dataIndex==="id"?(i(),d(M,{key:2},{split:e(()=>[t(z,{type:"vertical"})]),default:e(()=>[t(R,{onClick:()=>{var r;return(r=S.value)==null?void 0:r.openWindow(m.id)}},{default:e(()=>[s("编辑")]),_:2},1032,["onClick"]),t(R,{onClick:()=>{var r;return(r=L.value)==null?void 0:r.openWindow(m.id)}},{default:e(()=>[s("日志")]),_:2},1032,["onClick"]),t(N,{title:"确定要删除?",onConfirm:r=>B(m.id)},{default:e(()=>[t(R,{class:"text-danger"},{default:e(()=>[s("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):v("",!0)]),expandedRowRender:e(({record:n})=>[t(E,{title:n.name,bordered:""},{default:e(()=>[t(x,{label:"分组"},{default:e(()=>[s(T(n.groupName),1)]),_:2},1024),t(x,{label:"Http请求类型",span:2},{default:e(()=>[n.requestMode==0?(i(),d(p,{key:0,bordered:!1,color:"processing"},{default:e(()=>[s("Post")]),_:1})):n.requestMode==1?(i(),d(p,{key:1,bordered:!1,color:"green"},{default:e(()=>[s("Get")]),_:1})):n.requestMode==2?(i(),d(p,{key:2,bordered:!1,color:"purple"},{default:e(()=>[s("Delete")]),_:1})):v("",!0)]),_:2},1024),t(x,{label:"执行端点",span:3},{default:e(()=>[s(T(n.jobPoint),1)]),_:2},1024),t(x,{label:"描述",span:3},{default:e(()=>[s(T(n.remark),1)]),_:2},1024)]),_:2},1032,["title"])]),expandColumnTitle:e(()=>[oe]),_:1},8,["data-source","scroll","row-selection"])]),t(ee,{ref_key:"refInfo",ref:S,onSuccess:()=>_()},null,8,["onSuccess"]),t(te,{ref_key:"refLog",ref:L,onSuccess:()=>_()},null,8,["onSuccess"])]),_:1},8,["spinning"])]),_:1})}}});export{me as default};
