var T=Object.defineProperty;var $=(r,a,s)=>a in r?T(r,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[a]=s;var y=(r,a,s)=>($(r,typeof a!="symbol"?a+"":a,s),s);import{S as f,p as x,d as E,z as S,r as d,o as h,e as F,w as i,a as l,j as g,m as b,c as D,k as U,t as w,F as P}from"./index-87b89bfd.js";class _{static findList(a,s,n={}){return f.post(`${this.urlPrefix}/findList/${s}/${a}`,n)}static saveForm(a){return f.post(`${this.urlPrefix}/create`,a)}static async getRoleMenuFunctionByRoleId(a){const s=await f.get(`${this.urlPrefix}/getRoleMenuFunctionByRoleId/${a}`),n=[];return s.data.forEach(m=>{n.push(m.id)}),{data:s.data,tree:x.genTreeData(s.data),keys:n}}}y(_,"urlPrefix","/api/admin/SysRoleMenuFunction");const N=E({__name:"FunctionAuthority",props:{onSuccess:{type:Function}},setup(r,{expose:a}){const s=r,n=S({visible:!1,saveLoading:!1,roleId:"",treeData:[],rowkeys:[]});a({open:(o="")=>{n.visible=!0,n.roleId=o,n.saveLoading=!0,_.getRoleMenuFunctionByRoleId(o).then(e=>{n.saveLoading=!1,n.treeData=e.tree,n.rowkeys=e.keys,console.log(n.rowkeys)})}});async function m(){const o=[];function e(k){k.forEach(c=>{c.children&&c.children.length>0&&e(c.children),c.checkedMenuFunctionIds&&c.checkedMenuFunctionIds.length>0&&o.push({roleId:n.roleId,menuId:c.id,menuFunctionIdList:c.checkedMenuFunctionIds})})}e(n.treeData),(await _.saveForm(o)).code==1&&(x.message.success("\u64CD\u4F5C\u6210\u529F!"),s.onSuccess(),n.visible=!1)}function C(o,e){o.target.checked?(e.checkedMenuFunctionIds=e.menuFunctions.map(p=>p.id),e.indeterminate=e.checkedMenuFunctionIds.length>0&&e.checkedMenuFunctionIds.length<e.menuFunctions.length,e.checkAll=e.checkedMenuFunctionIds.length===e.menuFunctions.length):(e.checkedMenuFunctionIds=[],e.indeterminate=!1)}function I(o,e){e.indeterminate=!!o.length&&o.length<e.menuFunctions.length,e.checkAll=o.length===e.menuFunctions.length}return(o,e)=>{const p=d("a-button"),k=d("ASpace"),c=d("ATableColumn"),v=d("a-checkbox"),A=d("ADivider"),M=d("a-checkbox-group"),R=d("ATable"),B=d("a-spin"),L=d("a-drawer");return h(),F(L,{visible:n.visible,"onUpdate:visible":e[3]||(e[3]=t=>n.visible=t),title:"\u89D2\u8272\u529F\u80FD\u8BBE\u7F6E",centered:"",onOk:e[4]||(e[4]=t=>n.visible=!1),width:1200,footer:null},{extra:i(()=>[l(k,null,{default:i(()=>[l(p,{type:"primary",onClick:e[0]||(e[0]=t=>m())},{default:i(()=>[g("\u4FDD\u5B58/\u63D0\u4EA4")]),_:1}),l(p,{onClick:e[1]||(e[1]=()=>n.visible=!n.visible)},{default:i(()=>[g("\u5173\u95ED")]),_:1})]),_:1})]),default:i(()=>[l(B,{spinning:n.saveLoading},{default:i(()=>[l(R,{"data-source":n.treeData,size:"small",expandedRowKeys:n.rowkeys,"onUpdate:expandedRowKeys":e[2]||(e[2]=t=>n.rowkeys=t),pagination:!1,"row-key":"id"},{default:i(()=>[l(c,{title:"\u83DC\u5355","data-index":"name",width:"250px"}),l(c,{title:"\u529F\u80FD","data-index":"id"},{default:i(({record:t})=>[t.menuFunctions.length>0?(h(),F(k,{key:0,size:8},{default:i(()=>[t.menuFunctions.length>0?(h(),F(v,{key:0,checked:t.checkAll,"onUpdate:checked":u=>t.checkAll=u,indeterminate:t.indeterminate,onChange:u=>C(u,t)},{default:i(()=>[g(" \u5168\u9009/\u53D6\u6D88 ")]),_:2},1032,["checked","onUpdate:checked","indeterminate","onChange"])):b("",!0),l(A,{type:"vertical"}),l(M,{style:{display:"block"},value:t.checkedMenuFunctionIds,"onUpdate:value":u=>t.checkedMenuFunctionIds=u,onChange:u=>I(u,t)},{default:i(()=>[(h(!0),D(P,null,U(t.menuFunctions,u=>(h(),D("span",{key:u.id,class:"mr-16"},[l(v,{value:u.id},{default:i(()=>[g(w(u.label),1)]),_:2},1032,["value"])]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),_:2},1024)):b("",!0)]),_:1})]),_:1},8,["data-source","expandedRowKeys"])]),_:1},8,["spinning"])]),_:1},8,["visible"])}}});export{N as _};
