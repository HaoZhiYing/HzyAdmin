import{d as T,y as Y,a4 as Z,C as E,b as ee,q as te,a6 as D,s as ae,m as F,r as u,o as r,e as p,w as o,a as n,u as _,i as d,t as N,l as v,c as w,j as O,F as U,f as oe}from"./index-294e8e84.js";import{_ as k}from"./AppIcon.vue_vue_type_script_setup_true_lang-a041bba6.js";import{_ as ne}from"./Info.vue_vue_type_script_setup_true_lang-4b68cb88.js";import{_ as se}from"./PageContainer.vue_vue_type_script_setup_true_lang-b0c3a0a7.js";import{_ as ue}from"./TableCurd.vue_vue_type_script_setup_true_lang-c21e52c1.js";import{S as le}from"./SysOrganizationService-55bb5f83.js";const re={key:0},ie={key:1},de=["onClick"],ce=oe("a",{class:"text-danger"},"\u5220\u9664",-1),me=T({name:"system_user"}),ke=T({...me,props:{isFindBack:{type:Boolean,default:!1},defaultRowIds:null,type:{type:Boolean,default:!0}},emits:["findBackChange"],setup(L,{emit:K}){const h=L,t=Y({search:{state:!1,vm:{name:void 0,loginName:void 0,organizationId:void 0},sort:[]},loading:!1,page:1,size:10,total:100,columns:[],data:[]}),f=Z(),C=E(),B=E(),S=E(),z=E(),V=E({defaultRowIds:ee(()=>h.defaultRowIds)});te(()=>{y(),le.sysOrganizationTree().then(s=>{z.value=s.data.rows})});async function y(){try{t.loading=!0;const s=await D.findList(t.page,t.size,t.search.vm,t.search.sort);if(t.loading=!1,s.code!=1)return;t.page=s.data.page,t.size=s.data.size,t.total=s.data.total,t.columns=s.data.columns,t.data=s.data.dataSource,x.setCheckboxRow()}catch{t.loading=!1}}async function A(s){var i,c;let a=[];if(s?a.push(s):a=(c=(i=C.value)==null?void 0:i.getSelectedRowKeys())!=null?c:[],a.length==0)return F.message.error("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u884C!");try{t.loading=!0;const m=await D.deleteList(a);if(t.loading=!1,m.code!=1)return;F.message.success("\u5220\u9664\u6210\u529F!"),y()}catch{t.loading=!1}}function j(){D.exportExcel(t.search.vm,t.search.sort)}const x={initRows(){!h.isFindBack||ae(()=>h.defaultRowIds,s=>{x.setCheckboxRow()})},setCheckboxRow(){var s,a;!h.isFindBack||((s=C.value)==null||s.clearSelectedRowKeys(),(a=C.value)==null||a.setSelectedRowKeys(V.value.defaultRowIds))},onChange(){var a,i;if(!!h.isFindBack){var s=(i=(a=C.value)==null?void 0:a.getSelectedRowKeys())!=null?i:[];if(s&&s.length==0)return F.message.warning("\u8BF7\u9009\u62E9\u4E00\u6761\u6570\u636E!");if(h.type&&s.length>1)return F.message.warning("\u53EA\u80FD\u9009\u62E9\u4E00\u6761\u6570\u636E!");K("findBackChange",x.getRowsByIds(s))}},getRowsByIds(s){var a=[],i=t.data;for(let c=0;c<i.length;c++){const m=i[c];s.filter(b=>b==m.id).length>0&&a.push(m)}return a}};return x.initRows(),(s,a)=>{const i=u("a-input"),c=u("a-form-item"),m=u("a-col"),b=u("a-tree-select"),g=u("a-button"),M=u("a-space"),q=u("a-row"),H=u("a-form"),R=u("a-popconfirm"),P=u("a-menu-item"),G=u("a-menu"),J=u("a-dropdown"),Q=u("a-checkbox"),W=u("a-popover"),I=u("a-table-column"),X=u("a-divider");return r(),p(se,{show:!s.$props.isFindBack},{default:o(()=>[n(ue,{ref_key:"refTableCurd",ref:C,config:t,onChange:a[10]||(a[10]=e=>{var l,$;t.page=(l=e.pagination.current)!=null?l:1,t.size=($=e.pagination.pageSize)!=null?$:t.size,t.search.sort=e.sorter instanceof Array?[...e.sorter]:[e.sorter],y()}),onShowSizeChange:a[11]||(a[11]=({current:e,size:l})=>{t.page=e==0?1:e,t.size=l,y()})},{search:o(()=>[_(f).search?(r(),p(H,{key:0,ref_key:"refSearchForm",ref:S,model:t.search.vm},{default:o(()=>[n(q,{gutter:[16,0]},{default:o(()=>[n(m,{xs:24,sm:12,md:8,lg:6,xl:6},{default:o(()=>[n(c,{class:"mb-0",name:"name",label:"\u771F\u5B9E\u59D3\u540D"},{default:o(()=>[d(N(_(f))+" ",1),n(i,{value:t.search.vm.name,"onUpdate:value":a[0]||(a[0]=e=>t.search.vm.name=e),placeholder:"\u771F\u5B9E\u540D\u79F0"},null,8,["value"])]),_:1})]),_:1}),n(m,{xs:24,sm:12,md:8,lg:6,xl:6},{default:o(()=>[n(c,{class:"mb-0",name:"loginName",label:"\u8D26\u6237\u540D\u79F0"},{default:o(()=>[n(i,{value:t.search.vm.loginName,"onUpdate:value":a[1]||(a[1]=e=>t.search.vm.loginName=e),placeholder:"\u8D26\u6237\u540D\u79F0"},null,8,["value"])]),_:1})]),_:1}),n(m,{xs:24,sm:12,md:8,lg:6,xl:6},{default:o(()=>[n(c,{class:"mb-0",name:"organizationId",label:"\u6240\u5C5E\u7EC4\u7EC7"},{default:o(()=>[n(b,{value:t.search.vm.organizationId,"onUpdate:value":a[2]||(a[2]=e=>t.search.vm.organizationId=e),"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"\u6240\u5C5E\u7EC4\u7EC7","allow-clear":"","tree-default-expand-all":"","tree-data":z.value,"field-names":{children:"children",label:"title",value:"key"},class:"w100"},null,8,["value","tree-data"])]),_:1})]),_:1}),n(m,{xs:24,sm:12,md:8,lg:6,xl:6,class:"text-right"},{default:o(()=>[n(M,{size:8},{default:o(()=>[n(g,{onClick:a[3]||(a[3]=e=>{var l;t.page=1,(l=S.value)==null||l.resetFields(),y()})},{default:o(()=>[d(" \u91CD\u7F6E ")]),_:1}),n(g,{type:"primary",onClick:a[4]||(a[4]=e=>{t.page=1,y()})},{default:o(()=>[d(" \u67E5\u8BE2 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])):v("",!0)]),"toolbar-left":o(()=>[_(f).search?(r(),p(g,{key:0,onClick:a[5]||(a[5]=e=>t.search.state=!t.search.state)},{default:o(()=>[t.search.state?(r(),w("div",re,[n(k,{name:"UpOutlined"}),d("\xA0\xA0\u6536\u8D77")])):(r(),w("div",ie,[n(k,{name:"DownOutlined"}),d("\xA0\xA0\u5C55\u5F00")]))]),_:1})):v("",!0),_(f).insert?(r(),p(g,{key:1,type:"primary",onClick:a[6]||(a[6]=()=>{var e;return(e=B.value)==null?void 0:e.open()})},{icon:o(()=>[n(k,{name:"PlusOutlined"})]),default:o(()=>[d(" \u65B0\u5EFA ")]),_:1})):v("",!0),_(f).delete?(r(),p(R,{key:2,title:"\u60A8\u786E\u5B9A\u8981\u5220\u9664?",onConfirm:a[7]||(a[7]=e=>A()),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"},{default:o(()=>[n(g,{type:"primary",danger:""},{icon:o(()=>[n(k,{name:"DeleteOutlined"})]),default:o(()=>[d(" \u6279\u91CF\u5220\u9664 ")]),_:1})]),_:1})):v("",!0),s.$props.isFindBack?(r(),p(g,{key:3,type:"primary",onClick:a[8]||(a[8]=e=>x.onChange())},{icon:o(()=>[n(k,{name:"CheckOutlined"})]),default:o(()=>[d(" \u5E26\u56DE\u6570\u636E ")]),_:1})):v("",!0)]),"toolbar-right":o(()=>[n(J,null,{overlay:o(()=>[n(G,null,{default:o(()=>[n(P,{key:"1",onClick:a[9]||(a[9]=e=>j())},{default:o(()=>[d("\u5BFC\u51FA Excel")]),_:1})]),_:1})]),default:o(()=>[n(g,null,{default:o(()=>[d(" \u66F4\u591A "),n(k,{name:"ellipsis-outlined"})]),_:1})]),_:1}),n(W,null,{content:o(()=>[(r(!0),w(U,null,O(t.columns.filter(e=>e.fieldName.substr(0,1)!="_"),e=>(r(),w("div",null,[n(Q,{checked:e.show,"onUpdate:checked":l=>e.show=l},{default:o(()=>[d(N(e.title),1)]),_:2},1032,["checked","onUpdate:checked"])]))),256))]),default:o(()=>[n(g,{type:"text"},{icon:o(()=>[n(k,{name:"setting-outlined"})]),_:1})]),_:1})]),"table-col":o(()=>[(r(!0),w(U,null,O(t.columns.filter(e=>e.fieldName!=="id"&&e.show),(e,l)=>(r(),p(I,{key:e.fieldName,title:e.title,"data-index":e.fieldName,sorter:e.sort?{multiple:l+1}:!1},null,8,["title","data-index","sorter"]))),128)),_(f).update||_(f).delete?(r(),p(I,{key:0,title:"\u64CD\u4F5C","data-index":"id"},{default:o(({record:e})=>[_(f).update?(r(),w("a",{key:0,href:"javascript:;",onClick:()=>{var l;return(l=B.value)==null?void 0:l.open(e.id)}},"\u7F16\u8F91",8,de)):v("",!0),n(X,{type:"vertical"}),_(f).delete?(r(),p(R,{key:1,title:"\u60A8\u786E\u5B9A\u8981\u5220\u9664?",onConfirm:l=>A(e.id),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"},{default:o(()=>[ce]),_:2},1032,["onConfirm"])):v("",!0)]),_:1})):v("",!0)]),_:1},8,["config"]),n(ne,{ref_key:"refInfo",ref:B,onSuccess:()=>y()},null,8,["onSuccess"])]),_:1},8,["show"])}}});export{ke as _};
