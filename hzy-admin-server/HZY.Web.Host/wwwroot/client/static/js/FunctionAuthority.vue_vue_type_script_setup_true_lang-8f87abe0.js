var E=Object.defineProperty;var S=(r,a,s)=>a in r?E(r,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[a]=s;var v=(r,a,s)=>(S(r,typeof a!="symbol"?a+"":a,s),s);import{R as f,m as x,d as U,y as $,r as d,o as k,e as F,w as i,a as c,i as m,l as b,c as D,j as w,t as L,F as P}from"./index-07368c36.js";class _{static findList(a,s,n={},p=[]){return f.post(`${this.urlPrefix}/findList`,{page:a,size:s,search:n,searchSort:p})}static saveForm(a){return f.post(`${this.urlPrefix}/create`,a)}static async getRoleMenuFunctionByRoleId(a){const s=await f.get(`${this.urlPrefix}/getRoleMenuFunctionByRoleId/${a}`),n=[];return s.data.forEach(p=>{n.push(p.id)}),{data:s.data,tree:x.genTreeData(s.data),keys:n}}}v(_,"urlPrefix","/api/admin/SysRoleMenuFunction");const N=U({__name:"FunctionAuthority",props:{onSuccess:{type:Function}},setup(r,{expose:a}){const s=r,n=$({visible:!1,loading:!1,roleId:"",treeData:[],rowkeys:[]});a({open:(o="")=>{n.visible=!0,n.roleId=o,n.loading=!0,_.getRoleMenuFunctionByRoleId(o).then(e=>{n.loading=!1,n.treeData=e.tree,n.rowkeys=e.keys,console.log(n.rowkeys)})}});async function p(){const o=[];function e(g){g.forEach(l=>{l.children&&l.children.length>0&&e(l.children),l.checkedMenuFunctionIds&&l.checkedMenuFunctionIds.length>0&&o.push({roleId:n.roleId,menuId:l.id,menuFunctionIdList:l.checkedMenuFunctionIds})})}e(n.treeData),(await _.saveForm(o)).code==1&&(x.message.success("\u64CD\u4F5C\u6210\u529F!"),s.onSuccess(),n.visible=!1)}function C(o,e){o.target.checked?(e.checkedMenuFunctionIds=e.menuFunctions.map(h=>h.id),e.indeterminate=e.checkedMenuFunctionIds.length>0&&e.checkedMenuFunctionIds.length<e.menuFunctions.length,e.checkAll=e.checkedMenuFunctionIds.length===e.menuFunctions.length):(e.checkedMenuFunctionIds=[],e.indeterminate=!1)}function I(o,e){e.indeterminate=!!o.length&&o.length<e.menuFunctions.length,e.checkAll=o.length===e.menuFunctions.length}return(o,e)=>{const h=d("a-button"),g=d("ASpace"),l=d("ATableColumn"),y=d("a-checkbox"),A=d("ADivider"),M=d("a-checkbox-group"),R=d("ATable"),B=d("a-spin"),T=d("a-drawer");return k(),F(T,{visible:n.visible,"onUpdate:visible":e[3]||(e[3]=t=>n.visible=t),title:"\u89D2\u8272\u529F\u80FD\u8BBE\u7F6E",centered:"",onOk:e[4]||(e[4]=t=>n.visible=!1),width:1200,footer:null},{extra:i(()=>[c(g,null,{default:i(()=>[c(h,{type:"primary",onClick:e[0]||(e[0]=t=>p())},{default:i(()=>[m("\u4FDD\u5B58/\u63D0\u4EA4")]),_:1}),c(h,{onClick:e[1]||(e[1]=()=>n.visible=!n.visible)},{default:i(()=>[m("\u5173\u95ED")]),_:1})]),_:1})]),default:i(()=>[c(B,{spinning:n.loading},{default:i(()=>[c(R,{"data-source":n.treeData,size:"small",expandedRowKeys:n.rowkeys,"onUpdate:expandedRowKeys":e[2]||(e[2]=t=>n.rowkeys=t),pagination:!1,"row-key":"id"},{default:i(()=>[c(l,{title:"\u83DC\u5355","data-index":"name",width:"250px"}),c(l,{title:"\u529F\u80FD","data-index":"id"},{default:i(({record:t})=>[t.menuFunctions.length>0?(k(),F(g,{key:0,size:8},{default:i(()=>[t.menuFunctions.length>0?(k(),F(y,{key:0,checked:t.checkAll,"onUpdate:checked":u=>t.checkAll=u,indeterminate:t.indeterminate,onChange:u=>C(u,t)},{default:i(()=>[m(" \u5168\u9009/\u53D6\u6D88 ")]),_:2},1032,["checked","onUpdate:checked","indeterminate","onChange"])):b("",!0),c(A,{type:"vertical"}),c(M,{style:{display:"block"},value:t.checkedMenuFunctionIds,"onUpdate:value":u=>t.checkedMenuFunctionIds=u,onChange:u=>I(u,t)},{default:i(()=>[(k(!0),D(P,null,w(t.menuFunctions,u=>(k(),D("span",{key:u.id,class:"mr-16"},[c(y,{value:u.id},{default:i(()=>[m(L(u.label),1)]),_:2},1032,["value"])]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])]),_:2},1024)):b("",!0)]),_:1})]),_:1},8,["data-source","expandedRowKeys"])]),_:1},8,["spinning"])]),_:1},8,["visible"])}}});export{N as _};
