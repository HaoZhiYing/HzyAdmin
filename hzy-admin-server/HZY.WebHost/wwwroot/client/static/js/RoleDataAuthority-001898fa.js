var F=Object.defineProperty;var K=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var A=(s,n,d)=>n in s?F(s,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):s[n]=d,k=(s,n)=>{for(var d in n||(n={}))z.call(n,d)&&A(s,d,n[d]);if(K)for(var d of K(n))B.call(n,d)&&A(s,d,n[d]);return s};import{p as m,t as _,aS as b,aT as H,r as O,H as D,c,S as U,m as x,q as $,w as i,h as r,g as a,K as N,d as R,e as w,z as V,n as y}from"./index-95a530ff.js";import{o as q}from"./organizationService-4d7275c2.js";const u="admin/SysDataAuthority";var C={findList(s,n,d={}){return m(`${u}/findList/${s}/${n}`,d,!1)},deleteList(s){return console.log(s),s&&s.length===0?_.message("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u6570\u636E!","\u8B66\u544A"):m(`${u}/deleteList`,s,!1)},findForm(s){return b(`${u}/findForm${s?"/"+s:""}`)},saveForm(s){return s.id?m(`${u}/update`,s):m(`${u}/create`,s)},exportExcel(s){return H(`${u}/exportExcel`,s)},getDataAuthorityByRoleId(s){return b(`${u}/getDataAuthorityByRoleId/${s}`)}};const W=y("\u63D0\u4EA4"),Y=y("\u5173\u95ED"),j=y("\u81EA\u5B9A\u4E49\u6743\u9650"),G=y("\u67E5\u770B\u6240\u6709\u6570\u636E"),J=y("\u4EC5\u67E5\u770B\u672C\u7EC4\u7EC7"),M=y("\u4EC5\u67E5\u770B\u672C\u7EC4\u7EC7\u548C\u4E0B\u5C5E\u7EC4\u7EC7"),P=y("\u4EC5\u67E5\u770B\u672C\u4EBA"),Q={key:0},X=y("\u81EA\u5B9A\u4E49\u6570\u636E\u6743\u9650"),Z={class:"mb-15"},ee=y("\u5168\u9009/\u5168\u4E0D\u9009"),te=y("\u5C55\u5F00/\u6298\u53E0"),se={style:{"max-height":"280px","overflow-y":"auto"}},ne={emits:["onSuccess"],setup(s,{expose:n,emit:d}){const e=O({roleId:"",loading:!1,visible:!1,form:{sysDataAuthority:{},sysDataAuthorityCustomList:[]},selectAll:!1,expandedAll:!1,tree:{data:[],expandedKeys:[],selectedKeys:[],checkedKeys:[],allKeys:[],allExpandedKeys:[],loadingTree:!1}}),f={openWindow({visible:l,key:t}){e.visible=l,e.roleId=t,this.findForm()},findForm(){e.saveLoading=!0,C.getDataAuthorityByRoleId(e.roleId).then(l=>{e.saveLoading=!1,l.code==1&&(e.form=l.data,e.form.sysDataAuthority.roleId=e.roleId,this.sysOrganizationTree())})},sysOrganizationTree(){e.tree.loadingTree=!0,e.tree.checkedKeys=[],q.sysOrganizationTree().then(l=>{e.tree.loadingTree=!1;let t=l.data;e.tree.data=t.rows,e.tree.expandedKeys=t.expandedRowKeys,e.tree.allKeys=t.allKeys,e.tree.allExpandedKeys=t.expandedRowKeys;var h=e.form.sysDataAuthorityCustomList;for(let p=0;p<h.length;p++){const g=h[p];e.tree.checkedKeys.push(g.sysOrganizationId)}e.selectAll=e.tree.checkedKeys.length==e.tree.allKeys.length,e.expandedAll=e.tree.expandedKeys.length==e.tree.allExpandedKeys.length})},saveForm(){if(e.form.sysDataAuthority.permissionType===1){var l=e.tree.checkedKeys;e.form.sysDataAuthorityCustomList=[];for(let t=0;t<l.length;t++){const h=l[t];e.form.sysDataAuthorityCustomList.push({sysOrganizationId:h})}}else e.form.sysDataAuthorityCustomList=[];C.saveForm(e.form).then(t=>{if(t.code!=1)return _.message("\u4FDD\u5B58\u5931\u8D25!","\u9519\u8BEF");e.visible=!1,console.log(1231231312),_.message("\u4FDD\u5B58\u6210\u529F!","\u6210\u529F"),d("onSuccess",t.data)})},onSelectAll(){e.selectAll?e.tree.checkedKeys=e.tree.allKeys:e.tree.checkedKeys=[]},onExpandedAll(){e.expandedAll?e.tree.expandedKeys=e.tree.allExpandedKeys:e.tree.expandedKeys=[]}};return D(()=>e.tree.checkedKeys,l=>{console.log("checkedKeys",l),e.selectAll=l.length==e.tree.allKeys.length}),D(()=>e.tree.expandedKeys,l=>{e.expandedAll=l.length==e.tree.allExpandedKeys.length}),n(k({},f)),(l,t)=>{const h=c("a-button"),p=c("a-radio"),g=c("a-radio-group"),L=c("a-divider"),v=c("a-checkbox"),T=c("a-tree"),S=c("a-spin"),E=c("a-modal"),I=U("drag");return x(),$(E,{visible:a(e).visible,"onUpdate:visible":t[9]||(t[9]=o=>a(e).visible=o),title:"\u6570\u636E\u6743\u9650\u8BBE\u7F6E",centered:"",onOk:t[10]||(t[10]=o=>a(e).visible=!1),width:400,bodyStyle:{overflowY:"auto",height:"calc(100vh - 300px)"}},{footer:i(()=>[r(h,{type:"primary",onClick:t[0]||(t[0]=o=>f.saveForm()),loading:a(e).saveLoading},{default:i(()=>[W]),_:1},8,["loading"]),r(h,{type:"danger",ghost:"",onClick:t[1]||(t[1]=o=>a(e).visible=!1),class:"ml-15"},{default:i(()=>[Y]),_:1})]),default:i(()=>[N((x(),$(S,{spinning:a(e).loading},{default:i(()=>[r(g,{value:a(e).form.sysDataAuthority.permissionType,"onUpdate:value":t[2]||(t[2]=o=>a(e).form.sysDataAuthority.permissionType=o)},{default:i(()=>[r(p,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:1},{default:i(()=>[j]),_:1}),r(p,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:2},{default:i(()=>[G]),_:1}),r(p,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:3},{default:i(()=>[J]),_:1}),r(p,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:4},{default:i(()=>[M]),_:1}),r(p,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:5},{default:i(()=>[P]),_:1})]),_:1},8,["value"]),a(e).form.sysDataAuthority.permissionType===1?(x(),R("div",Q,[r(L,null,{default:i(()=>[X]),_:1}),w("div",Z,[r(v,{checked:a(e).selectAll,"onUpdate:checked":t[3]||(t[3]=o=>a(e).selectAll=o),onChange:t[4]||(t[4]=o=>f.onSelectAll())},{default:i(()=>[ee]),_:1},8,["checked"]),r(v,{checked:a(e).expandedAll,"onUpdate:checked":t[5]||(t[5]=o=>a(e).expandedAll=o),onChange:t[6]||(t[6]=o=>f.onExpandedAll())},{default:i(()=>[te]),_:1},8,["checked"])]),w("div",se,[r(T,{expandedKeys:a(e).tree.expandedKeys,"onUpdate:expandedKeys":t[7]||(t[7]=o=>a(e).tree.expandedKeys=o),checkedKeys:a(e).tree.checkedKeys,"onUpdate:checkedKeys":t[8]||(t[8]=o=>a(e).tree.checkedKeys=o),checkable:"","tree-data":a(e).tree.data},null,8,["expandedKeys","checkedKeys","tree-data"])])])):V("",!0)]),_:1},8,["spinning"])),[[I]])]),_:1},8,["visible","bodyStyle"])}}};export{ne as default};
