var D=Object.defineProperty;var x=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var C=(t,a,e)=>a in t?D(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e,I=(t,a)=>{for(var e in a||(a={}))E.call(a,e)&&C(t,e,a[e]);if(x)for(var e of x(a))S.call(a,e)&&C(t,e,a[e]);return t};import{p as F,X as V,r as z,a as W,c as r,U as q,m as g,q as _,w as d,h as m,L as H,g as p,e as B,f as y,B as M,d as R,D as O,F as X,n as b,W as Y,t as T}from"./index-d1b7dbe6.js";const f="admin/SysRoleMenuFunction";var A={findList(t,a,e={}){return F(`${f}/findList/${t}/${a}`,e,!1)},saveForm(t){return t.id?F(`${f}/update`,t):F(`${f}/create`,t)},getRoleMenuFunctionByRoleId(t){return V(`${f}/getRoleMenuFunctionByRoleId/${t}`)}};const j=B("span",{class:"mr-15"},"\u89D2\u8272\u529F\u80FD\u8BBE\u7F6E",-1),G=b("\u4FDD\u5B58/\u63D0\u4EA4"),J={class:"mr-15"},K=b(" \u5168\u9009 "),Z={setup(t,{expose:a}){const e=z({roleId:"",data:[],loading:!1,visible:!1}),v=W(null),h={getRoleMenuFunctionTree(){e.loading=!0,A.getRoleMenuFunctionByRoleId(e.roleId).then(o=>{e.loading=!1;let n=o.data;e.data=n,Y(()=>{for(var c=0;c<e.data.length;c++){var i=e.data[c];if(i.menuFunctions.length>0){var u=i.levelCode.substr(0,i.levelCode.lastIndexOf("."));v.value.setTreeExpand(e.data.filter(k=>k.levelCode==u),!0)}}})})},save(){for(var o=e.data.filter(u=>u.menuFunctions.length>0),n=[],c=0;c<o.length;c++){var i=o[c];n.push({roleId:e.roleId,menuId:i.id,menuFunctionIdList:i.checkedMenuFunctionIds})}A.saveForm(n).then(u=>{if(u.code!=1)return T.message("\u4FDD\u5B58\u5931\u8D25!","\u9519\u8BEF");h.getRoleMenuFunctionTree(),T.message("\u4FDD\u5B58\u6210\u529F!","\u6210\u529F")})},onChangeCheckbox({values:o,row:n}){n.indeterminate=!!o.length&&o.length<n.menuFunctions.length,n.checkAll=o.length===n.menuFunctions.length},openWindow({visible:o,key:n}){e.visible=o,e.roleId=n,h.getRoleMenuFunctionTree()},setAllTreeExpand(){v.value.setAllTreeExpand(!0)},onCheckAllChange(o,n){o.target.checked?(n.checkedMenuFunctionIds=n.menuFunctions.map(c=>c.id),n.indeterminate=n.checkedMenuFunctionIds.length>0&&n.checkedMenuFunctionIds.length<n.menuFunctions.length,n.checkAll=n.checkedMenuFunctionIds.length===n.menuFunctions.length):(n.checkedMenuFunctionIds=[],n.indeterminate=!1)}};return a(I({},h)),(o,n)=>{const c=r("a-button"),i=r("a-checkbox"),u=r("vxe-column"),k=r("a-checkbox-group"),$=r("vxe-table"),U=r("a-spin"),L=r("a-modal"),N=q("drag");return g(),_(L,{visible:p(e).visible,"onUpdate:visible":n[0]||(n[0]=l=>p(e).visible=l),centered:"",width:"1200px",bodyStyle:{overflowY:"auto",height:"calc(100vh - 100px)"},footer:null},{title:d(()=>[j,m(c,{type:"primary",onClick:h.save},{default:d(()=>[G]),_:1},8,["onClick"])]),default:d(()=>[H((g(),_(U,{spinning:p(e).loading},{default:d(()=>[m($,{ref_key:"refTable",ref:v,resizable:"",data:p(e).data,"row-config":{isHover:!0},"tree-config":{transform:!0,rowField:"id",parentField:"parentId"},size:"small"},{default:d(()=>[m(u,{field:"name",title:"\u83DC\u5355\u540D\u79F0","tree-node":"",width:"250"},{default:d(({row:l})=>[B("span",J,y(l.name),1),l.menuFunctions.length>0?(g(),_(i,{key:0,checked:l.checkAll,"onUpdate:checked":s=>l.checkAll=s,indeterminate:l.indeterminate,onChange:s=>h.onCheckAllChange(s,l)},{default:d(()=>[K]),_:2},1032,["checked","onUpdate:checked","indeterminate","onChange"])):M("",!0)]),_:1}),m(u,{field:"id",title:"\u6743\u9650"},{default:d(({row:l})=>[l.menuFunctions.length>0?(g(),_(k,{key:0,style:{display:"block"},value:l.checkedMenuFunctionIds,"onUpdate:value":s=>l.checkedMenuFunctionIds=s,onChange:s=>h.onChangeCheckbox({values:s,row:l})},{default:d(()=>[(g(!0),R(X,null,O(l.menuFunctions,s=>(g(),R("span",{key:s.id,class:"mr-15"},[m(i,{value:s.id},{default:d(()=>[b(y(s.label),1)]),_:2},1032,["value"])]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):M("",!0)]),_:1})]),_:1},8,["data"])]),_:1},8,["spinning"])),[[N]])]),_:1},8,["visible","bodyStyle"])}}};export{Z as default};
