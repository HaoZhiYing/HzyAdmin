import{_ as W,b as G,r as H,K as J,a as T,i as Q,I as z,o as X,c as d,j as i,d as k,f as a,w as n,e as U,l,q as v,A as y,C as m,F as R,x as N,n as u,g as Y,h as Z,aW as F,t as b,V as $,aS as ee,k as te}from"./index-67425790.js";import ne from"./List-b58bc0b4.js";import ae from"./Info-021cbdb9.js";import{o as oe}from"./organizationService-fddbc9a4.js";const se=x=>(Y("data-v-cbfd93a0"),x=x(),Z(),x),le=u("\u67E5\u8BE2"),re=u("\u91CD\u7F6E"),de=u(" \u65B0\u5EFA "),ie=u(" \u6279\u91CF\u5220\u9664 "),ce=u(" \u5E26\u56DE\u6570\u636E "),ue=u("\u5BFC\u51FA Excel"),pe=u(" \u66F4\u591A\u64CD\u4F5C "),me=u("\u91CD\u7F6E"),fe=u(" \u68C0\u7D22 "),_e=["onClick"],ge=se(()=>U("a",{class:"text-danger"},"\u5220\u9664",-1)),he={name:"system_user"},ve=Object.assign(he,{props:{isFindBack:{type:Boolean,default(){return!1}},defaultRowIds:Array,type:{type:Boolean,default(){return!0}}},emits:["onChange"],setup(x,{emit:D}){const f=x,V=G(),t=H({search:{state:!1,vm:{name:null,loginName:null,organizationId:null}},loading:!1,pageSizeOptions:[10,20,50,100,500,1e3],rows:10,page:1,total:0,columns:[],data:[],tree:{data:[],expandedKeys:[],selectedKeys:[],loadingTree:!1},findBack:{defaultRowIds:J(()=>f.defaultRowIds)}}),K=T(null),_=T(null),g=V.getPowerByMenuId(Q.currentRoute.value.meta.menuId),r={onChange(s){const{currentPage:e,pageSize:c}=s;t.page=e==0?1:e,t.rows=c,r.findList()},onResetSearch(){t.page=1;let s=t.search.vm;for(let e in s)s[e]=null;r.findList()},findList(){t.loading=!0,F.findList(t.rows,t.page,t.search.vm).then(s=>{let e=s.data;t.loading=!1,t.page=e.page,t.rows=e.size,t.total=e.total,t.columns=e.columns,t.data=e.dataSource,r.findBack.setCheckboxRow()})},deleteList(s){let e=[];s?e.push(s):e=_.value.table.getCheckboxRecords().map(c=>c.id),F.deleteList(e).then(c=>{c.code==1&&(b.message("\u5220\u9664\u6210\u529F!",$.success),r.findList())})},openForm(s){if(!s&&!t.search.vm.organizationId)return b.message("\u8BF7\u9009\u62E9\u7EC4\u7EC7!",$.warn);K.value.openForm({visible:!0,key:s,organizationId:t.search.vm.organizationId})},exportExcel(){F.exportExcel(t.search.vm)},sysOrganizationTree(){t.tree.loadingTree=!0,oe.sysOrganizationTree().then(s=>{t.tree.loadingTree=!1;let e=s.data;t.tree.data=e.rows,t.tree.expandedKeys=e.expandedRowKeys,r.findList()})},getFirst(){t.tree.selectedKeys=[]},findBack:{initRows(){!f.isFindBack||z(()=>f.defaultRowIds,s=>{r.findBack.setCheckboxRow()})},setCheckboxRow(){!f.isFindBack||(_.value.table.setAllCheckboxRow(!1),_.value.table.setCheckboxRow(r.findBack.getRowsByIds(t.findBack.defaultRowIds),!0))},onChange(){if(!!f.isFindBack){var s=_.value.table.getCheckboxRecords();if(s&&s.length==0)return b.message("\u8BF7\u9009\u62E9\u4E00\u6761\u6570\u636E!","\u8B66\u544A");if(f.type&&s.length>1)return b.message("\u53EA\u80FD\u9009\u62E9\u4E00\u6761\u6570\u636E!","\u8B66\u544A");D("onChange",_.value.table.getCheckboxRecords())}},getRowsByIds(s){if(!!f.isFindBack){var e=[],c=t.data;for(let C=0;C<c.length;C++){const w=c[C];s.filter(h=>h==w.id).length>0&&e.push(w)}return e}}}};return r.findBack.initRows(),z(()=>t.tree.selectedKeys,s=>{t.search.vm.organizationId=s.length>0?s[0]:null,r.findList()}),X(()=>{r.sysOrganizationTree()}),(s,e)=>{const c=d("a-tree"),C=d("a-spin"),w=d("a-card"),h=d("a-col"),B=d("a-input"),p=d("a-button"),L=d("a-row"),S=d("a-popconfirm"),A=d("a-menu-item"),E=d("a-menu"),j=d("a-dropdown"),P=d("a-checkbox"),M=d("a-popover"),O=d("vxe-column"),q=d("a-divider");return i(),k("div",null,[a(L,{gutter:[15,15]},{default:n(()=>[a(h,{xs:24,sm:12,md:12,lg:5,xl:5},{default:n(()=>[a(w,{title:"\u7EC4\u7EC7\u67B6\u6784",class:"w100 mb-15 min-height"},{extra:n(()=>[U("a",{href:"javascript:void(0)",onClick:e[0]||(e[0]=(...o)=>r.getFirst&&r.getFirst(...o))},"\u67E5\u770B\u4E00\u7EA7")]),default:n(()=>[a(C,{spinning:l(t).tree.loadingTree},{default:n(()=>[a(c,{expandedKeys:l(t).tree.expandedKeys,"onUpdate:expandedKeys":e[1]||(e[1]=o=>l(t).tree.expandedKeys=o),selectedKeys:l(t).tree.selectedKeys,"onUpdate:selectedKeys":e[2]||(e[2]=o=>l(t).tree.selectedKeys=o),"tree-data":l(t).tree.data},null,8,["expandedKeys","selectedKeys","tree-data"])]),_:1},8,["spinning"])]),_:1})]),_:1}),a(h,{xs:24,sm:12,md:12,lg:19,xl:19},{default:n(()=>[a(ne,{ref_key:"refList",ref:_,tableData:l(t),onOnChange:r.onChange},{search:n(()=>[a(L,{gutter:[15,15]},{default:n(()=>[a(h,{xs:24,sm:12,md:8,lg:6,xl:6},{default:n(()=>[a(B,{value:l(t).search.vm.name,"onUpdate:value":e[3]||(e[3]=o=>l(t).search.vm.name=o),placeholder:"\u771F\u5B9E\u540D\u79F0"},null,8,["value"])]),_:1}),a(h,{xs:24,sm:12,md:8,lg:6,xl:6},{default:n(()=>[a(B,{value:l(t).search.vm.loginName,"onUpdate:value":e[4]||(e[4]=o=>l(t).search.vm.loginName=o),placeholder:"\u8D26\u6237\u540D\u79F0"},null,8,["value"])]),_:1}),a(h,{xs:24,sm:12,md:8,lg:6,xl:6,style:{float:"right"}},{default:n(()=>[a(p,{type:"primary",class:"mr-15",onClick:r.findList},{default:n(()=>[le]),_:1},8,["onClick"]),a(p,{class:"mr-15",onClick:r.onResetSearch},{default:n(()=>[re]),_:1},8,["onClick"])]),_:1})]),_:1})]),"toolbar-left":n(()=>[l(g).insert&&!s.$props.isFindBack?(i(),v(p,{key:0,type:"primary",onClick:e[5]||(e[5]=o=>r.openForm())},{icon:n(()=>[a(y,{name:"PlusOutlined"})]),default:n(()=>[de]),_:1})):m("",!0),l(g).delete&&!s.$props.isFindBack?(i(),v(S,{key:1,title:"\u60A8\u786E\u5B9A\u8981\u5220\u9664\u5417?",onConfirm:e[6]||(e[6]=o=>r.deleteList()),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"},{default:n(()=>[a(p,{type:"danger"},{icon:n(()=>[a(y,{name:"DeleteOutlined"})]),default:n(()=>[ie]),_:1})]),_:1})):m("",!0),s.$props.isFindBack?(i(),v(p,{key:2,type:"primary",onClick:e[7]||(e[7]=o=>r.findBack.onChange())},{icon:n(()=>[a(y,{name:"CheckOutlined"})]),default:n(()=>[ce]),_:1})):m("",!0),a(j,null,{overlay:n(()=>[a(E,null,{default:n(()=>[a(A,{key:"1",onClick:r.exportExcel},{default:n(()=>[ue]),_:1},8,["onClick"])]),_:1})]),default:n(()=>[a(p,null,{default:n(()=>[pe,a(y,{name:"DownOutlined"})]),_:1})]),_:1})]),"toolbar-right":n(()=>[a(B,{value:l(t).search.vm.name,"onUpdate:value":e[8]||(e[8]=o=>l(t).search.vm.name=o),placeholder:"\u540D\u79F0",onKeyup:r.findList},null,8,["value","onKeyup"]),a(p,{onClick:r.onResetSearch},{default:n(()=>[me]),_:1},8,["onClick"]),l(g).search?(i(),v(p,{key:0,onClick:e[9]||(e[9]=o=>l(t).search.state=!l(t).search.state)},{icon:n(()=>[a(y,{name:l(t).search.state?"UpOutlined":"DownOutlined"},null,8,["name"])]),default:n(()=>[fe]),_:1})):m("",!0),a(M,null,{content:n(()=>[(i(!0),k(R,null,N(l(t).columns.filter(o=>o.fieldName.substr(0,1)!="_"),o=>(i(),k("div",null,[a(P,{checked:o.show,"onUpdate:checked":I=>o.show=I,onChange:e[10]||(e[10]=()=>ee(()=>_.value.table.refreshColumn()))},{default:n(()=>[u(te(o.title),1)]),_:2},1032,["checked","onUpdate:checked"])]))),256))]),default:n(()=>[a(p,null,{default:n(()=>[a(y,{name:"BarsOutlined"})]),_:1})]),_:1})]),"table-col-default":n(()=>[(i(!0),k(R,null,N(l(t).columns.filter(o=>o.fieldName!="id"),o=>(i(),k(R,null,[o.fieldName!="id"?(i(),v(O,{field:o.fieldName,title:o.title,visible:o.show,key:o.id},null,8,["field","title","visible"])):m("",!0)],64))),256)),(l(g).update||l(g).delete)&&!s.$props.isFindBack?(i(),v(O,{key:0,field:"id",title:"\u64CD\u4F5C"},{default:n(({row:o})=>[l(g).update?(i(),k("a",{key:0,href:"javascript:void(0)",onClick:I=>r.openForm(o.id)},"\u7F16\u8F91",8,_e)):m("",!0),a(q,{type:"vertical"}),l(g).delete?(i(),v(S,{key:1,title:"\u60A8\u786E\u5B9A\u8981\u5220\u9664\u5417?",onConfirm:I=>r.deleteList(o.id),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"},{default:n(()=>[ge]),_:2},1032,["onConfirm"])):m("",!0)]),_:1})):m("",!0)]),_:1},8,["tableData","onOnChange"])]),_:1})]),_:1}),a(ae,{ref_key:"refForm",ref:K,onOnSuccess:e[11]||(e[11]=()=>r.findList())},null,512)])}}});var we=W(ve,[["__scopeId","data-v-cbfd93a0"]]);export{we as default};
