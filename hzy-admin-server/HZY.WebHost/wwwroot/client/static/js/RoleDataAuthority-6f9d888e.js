import{p as u,t as _,U as K,V as I,r as T,I as A,j as y,W as S,k as x,q as k,w as n,g as d,f as o,L as F,c as B,d as b,E as U,n as i}from"./index-0d89598d.js";import{o as z}from"./organizationService-84bce6c5.js";const c="admin/SysDataAuthority",D={findList(s,f,g={}){return u(`${c}/findList/${s}/${f}`,g,!1)},deleteList(s){return console.log(s),s&&s.length===0?_.message("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u6570\u636E!","\u8B66\u544A"):u(`${c}/deleteList`,s,!1)},findForm(s){return K(`${c}/findForm${s?"/"+s:""}`)},saveForm(s){return s.id?u(`${c}/update`,s):u(`${c}/create`,s)},exportExcel(s){return I(`${c}/exportExcel`,s)},getDataAuthorityByRoleId(s){return K(`${c}/getDataAuthorityByRoleId/${s}`)}},O=i("\u63D0\u4EA4"),H=i("\u5173\u95ED"),N=i("\u81EA\u5B9A\u4E49\u6743\u9650"),R=i("\u67E5\u770B\u6240\u6709\u6570\u636E"),V=i("\u4EC5\u67E5\u770B\u672C\u7EC4\u7EC7"),W=i("\u4EC5\u67E5\u770B\u672C\u7EC4\u7EC7\u548C\u4E0B\u5C5E\u7EC4\u7EC7"),j=i("\u4EC5\u67E5\u770B\u672C\u4EBA"),q={key:0},Y=i("\u81EA\u5B9A\u4E49\u6570\u636E\u6743\u9650"),G={class:"mb-15"},J=i("\u5168\u9009/\u5168\u4E0D\u9009"),M=i("\u5C55\u5F00/\u6298\u53E0"),P={style:{"max-height":"280px","overflow-y":"auto"}},Z={emits:["onSuccess"],setup(s,{expose:f,emit:g}){const e=T({roleId:"",loading:!1,visible:!1,form:{sysDataAuthority:{},sysDataAuthorityCustomList:[]},selectAll:!1,expandedAll:!1,tree:{data:[],expandedKeys:[],selectedKeys:[],checkedKeys:[],allKeys:[],allExpandedKeys:[],loadingTree:!1}}),h={openWindow({visible:l,key:t}){e.visible=l,e.roleId=t,this.findForm()},findForm(){e.saveLoading=!0,D.getDataAuthorityByRoleId(e.roleId).then(l=>{e.saveLoading=!1,l.code==1&&(e.form=l.data,e.form.sysDataAuthority.roleId=e.roleId,this.sysOrganizationTree())})},sysOrganizationTree(){e.tree.loadingTree=!0,e.tree.checkedKeys=[],z.sysOrganizationTree().then(l=>{e.tree.loadingTree=!1;let t=l.data;e.tree.data=t.rows,e.tree.expandedKeys=t.expandedRowKeys,e.tree.allKeys=t.allKeys,e.tree.allExpandedKeys=t.expandedRowKeys;var p=e.form.sysDataAuthorityCustomList;for(let r=0;r<p.length;r++){const m=p[r];e.tree.checkedKeys.push(m.sysOrganizationId)}e.selectAll=e.tree.checkedKeys.length==e.tree.allKeys.length,e.expandedAll=e.tree.expandedKeys.length==e.tree.allExpandedKeys.length})},saveForm(){if(e.form.sysDataAuthority.permissionType===1){var l=e.tree.checkedKeys;e.form.sysDataAuthorityCustomList=[];for(let t=0;t<l.length;t++){const p=l[t];e.form.sysDataAuthorityCustomList.push({sysOrganizationId:p})}}else e.form.sysDataAuthorityCustomList=[];D.saveForm(e.form).then(t=>{if(t.code!=1)return _.message("\u4FDD\u5B58\u5931\u8D25!","\u9519\u8BEF");e.visible=!1,console.log(1231231312),_.message("\u4FDD\u5B58\u6210\u529F!","\u6210\u529F"),g("onSuccess",t.data)})},onSelectAll(){e.selectAll?e.tree.checkedKeys=e.tree.allKeys:e.tree.checkedKeys=[]},onExpandedAll(){e.expandedAll?e.tree.expandedKeys=e.tree.allExpandedKeys:e.tree.expandedKeys=[]}};return A(()=>e.tree.checkedKeys,l=>{console.log("checkedKeys",l),e.selectAll=l.length==e.tree.allKeys.length}),A(()=>e.tree.expandedKeys,l=>{e.expandedAll=l.length==e.tree.allExpandedKeys.length}),f({...h}),(l,t)=>{const p=y("a-button"),r=y("a-radio"),m=y("a-radio-group"),$=y("a-divider"),v=y("a-checkbox"),L=y("a-tree"),w=y("a-spin"),C=y("a-modal"),E=S("drag");return x(),k(C,{visible:o(e).visible,"onUpdate:visible":t[9]||(t[9]=a=>o(e).visible=a),title:"\u6570\u636E\u6743\u9650\u8BBE\u7F6E",centered:"",onOk:t[10]||(t[10]=a=>o(e).visible=!1),width:400,bodyStyle:{overflowY:"auto",height:"calc(100vh - 300px)"}},{footer:n(()=>[d(p,{type:"primary",onClick:t[0]||(t[0]=a=>h.saveForm()),loading:o(e).saveLoading},{default:n(()=>[O]),_:1},8,["loading"]),d(p,{type:"danger",ghost:"",onClick:t[1]||(t[1]=a=>o(e).visible=!1),class:"ml-15"},{default:n(()=>[H]),_:1})]),default:n(()=>[F((x(),k(w,{spinning:o(e).loading},{default:n(()=>[d(m,{value:o(e).form.sysDataAuthority.permissionType,"onUpdate:value":t[2]||(t[2]=a=>o(e).form.sysDataAuthority.permissionType=a)},{default:n(()=>[d(r,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:1},{default:n(()=>[N]),_:1}),d(r,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:2},{default:n(()=>[R]),_:1}),d(r,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:3},{default:n(()=>[V]),_:1}),d(r,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:4},{default:n(()=>[W]),_:1}),d(r,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:5},{default:n(()=>[j]),_:1})]),_:1},8,["value"]),o(e).form.sysDataAuthority.permissionType===1?(x(),B("div",q,[d($,null,{default:n(()=>[Y]),_:1}),b("div",G,[d(v,{checked:o(e).selectAll,"onUpdate:checked":t[3]||(t[3]=a=>o(e).selectAll=a),onChange:t[4]||(t[4]=a=>h.onSelectAll())},{default:n(()=>[J]),_:1},8,["checked"]),d(v,{checked:o(e).expandedAll,"onUpdate:checked":t[5]||(t[5]=a=>o(e).expandedAll=a),onChange:t[6]||(t[6]=a=>h.onExpandedAll())},{default:n(()=>[M]),_:1},8,["checked"])]),b("div",P,[d(L,{expandedKeys:o(e).tree.expandedKeys,"onUpdate:expandedKeys":t[7]||(t[7]=a=>o(e).tree.expandedKeys=a),checkedKeys:o(e).tree.checkedKeys,"onUpdate:checkedKeys":t[8]||(t[8]=a=>o(e).tree.checkedKeys=a),checkable:"","tree-data":o(e).tree.data},null,8,["expandedKeys","checkedKeys","tree-data"])])])):U("",!0)]),_:1},8,["spinning"])),[[E]])]),_:1},8,["visible","bodyStyle"])}}};export{Z as default};
