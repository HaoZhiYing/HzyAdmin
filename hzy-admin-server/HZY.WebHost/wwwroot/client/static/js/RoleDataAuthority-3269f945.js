var E=Object.defineProperty;var v=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var K=(s,n,d)=>n in s?E(s,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):s[n]=d,A=(s,n)=>{for(var d in n||(n={}))S.call(n,d)&&K(s,d,n[d]);if(v)for(var d of v(n))F.call(n,d)&&K(s,d,n[d]);return s};import{p as m,t as x,aT as k,aV as B,r as z,I as b,c,j as D,q as O,w as i,f as r,l as a,d as U,e as $,C as H,n as y}from"./index-2bea66e6.js";import{o as N}from"./organizationService-3f2ec147.js";const u="admin/SysDataAuthority";var C={findList(s,n,d={}){return m(`${u}/findList/${s}/${n}`,d,!1)},deleteList(s){return console.log(s),s&&s.length===0?x.message("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u6570\u636E!","\u8B66\u544A"):m(`${u}/deleteList`,s,!1)},findForm(s){return k(`${u}/findForm${s?"/"+s:""}`)},saveForm(s){return s.id?m(`${u}/update`,s):m(`${u}/create`,s)},exportExcel(s){return B(`${u}/exportExcel`,s)},getDataAuthorityByRoleId(s){return k(`${u}/getDataAuthorityByRoleId/${s}`)}};const R=y("\u63D0\u4EA4"),V=y("\u5173\u95ED"),j=y("\u81EA\u5B9A\u4E49\u6743\u9650"),q=y("\u67E5\u770B\u6240\u6709\u6570\u636E"),W=y("\u4EC5\u67E5\u770B\u672C\u7EC4\u7EC7"),Y=y("\u4EC5\u67E5\u770B\u672C\u7EC4\u7EC7\u548C\u4E0B\u5C5E\u7EC4\u7EC7"),G=y("\u4EC5\u67E5\u770B\u672C\u4EBA"),J={key:0},M=y("\u81EA\u5B9A\u4E49\u6570\u636E\u6743\u9650"),P={class:"mb-15"},Q=y("\u5168\u9009/\u5168\u4E0D\u9009"),X=y("\u5C55\u5F00/\u6298\u53E0"),Z={style:{"max-height":"280px","overflow-y":"auto"}},ae={emits:["onSuccess"],setup(s,{expose:n,emit:d}){const e=z({roleId:"",loading:!1,visible:!1,form:{sysDataAuthority:{},sysDataAuthorityCustomList:[]},selectAll:!1,expandedAll:!1,tree:{data:[],expandedKeys:[],selectedKeys:[],checkedKeys:[],allKeys:[],allExpandedKeys:[],loadingTree:!1}}),f={openWindow({visible:l,key:t}){e.visible=l,e.roleId=t,this.findForm()},findForm(){e.saveLoading=!0,C.getDataAuthorityByRoleId(e.roleId).then(l=>{e.saveLoading=!1,l.code==1&&(e.form=l.data,e.form.sysDataAuthority.roleId=e.roleId,this.sysOrganizationTree())})},sysOrganizationTree(){e.tree.loadingTree=!0,e.tree.checkedKeys=[],N.sysOrganizationTree().then(l=>{e.tree.loadingTree=!1;let t=l.data;e.tree.data=t.rows,e.tree.expandedKeys=t.expandedRowKeys,e.tree.allKeys=t.allKeys,e.tree.allExpandedKeys=t.expandedRowKeys;var h=e.form.sysDataAuthorityCustomList;for(let p=0;p<h.length;p++){const g=h[p];e.tree.checkedKeys.push(g.sysOrganizationId)}e.selectAll=e.tree.checkedKeys.length==e.tree.allKeys.length,e.expandedAll=e.tree.expandedKeys.length==e.tree.allExpandedKeys.length})},saveForm(){if(e.form.sysDataAuthority.permissionType===1){var l=e.tree.checkedKeys;e.form.sysDataAuthorityCustomList=[];for(let t=0;t<l.length;t++){const h=l[t];e.form.sysDataAuthorityCustomList.push({sysOrganizationId:h})}}else e.form.sysDataAuthorityCustomList=[];C.saveForm(e.form).then(t=>{if(t.code!=1)return x.message("\u4FDD\u5B58\u5931\u8D25!","\u9519\u8BEF");e.visible=!1,console.log(1231231312),x.message("\u4FDD\u5B58\u6210\u529F!","\u6210\u529F"),d("onSuccess",t.data)})},onSelectAll(){e.selectAll?e.tree.checkedKeys=e.tree.allKeys:e.tree.checkedKeys=[]},onExpandedAll(){e.expandedAll?e.tree.expandedKeys=e.tree.allExpandedKeys:e.tree.expandedKeys=[]}};return b(()=>e.tree.checkedKeys,l=>{console.log("checkedKeys",l),e.selectAll=l.length==e.tree.allKeys.length}),b(()=>e.tree.expandedKeys,l=>{e.expandedAll=l.length==e.tree.allExpandedKeys.length}),n(A({},f)),(l,t)=>{const h=c("a-button"),p=c("a-radio"),g=c("a-radio-group"),L=c("a-divider"),_=c("a-checkbox"),T=c("a-tree"),w=c("a-spin"),I=c("a-modal");return D(),O(I,{visible:a(e).visible,"onUpdate:visible":t[9]||(t[9]=o=>a(e).visible=o),title:"\u6570\u636E\u6743\u9650\u8BBE\u7F6E",centered:"",onOk:t[10]||(t[10]=o=>a(e).visible=!1),width:400,bodyStyle:{overflowY:"auto",height:"calc(100vh - 300px)"}},{footer:i(()=>[r(h,{type:"primary",onClick:t[0]||(t[0]=o=>f.saveForm()),loading:a(e).saveLoading},{default:i(()=>[R]),_:1},8,["loading"]),r(h,{type:"danger",ghost:"",onClick:t[1]||(t[1]=o=>a(e).visible=!1),class:"ml-15"},{default:i(()=>[V]),_:1})]),default:i(()=>[r(w,{spinning:a(e).loading},{default:i(()=>[r(g,{value:a(e).form.sysDataAuthority.permissionType,"onUpdate:value":t[2]||(t[2]=o=>a(e).form.sysDataAuthority.permissionType=o)},{default:i(()=>[r(p,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:1},{default:i(()=>[j]),_:1}),r(p,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:2},{default:i(()=>[q]),_:1}),r(p,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:3},{default:i(()=>[W]),_:1}),r(p,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:4},{default:i(()=>[Y]),_:1}),r(p,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:5},{default:i(()=>[G]),_:1})]),_:1},8,["value"]),a(e).form.sysDataAuthority.permissionType===1?(D(),U("div",J,[r(L,null,{default:i(()=>[M]),_:1}),$("div",P,[r(_,{checked:a(e).selectAll,"onUpdate:checked":t[3]||(t[3]=o=>a(e).selectAll=o),onChange:t[4]||(t[4]=o=>f.onSelectAll())},{default:i(()=>[Q]),_:1},8,["checked"]),r(_,{checked:a(e).expandedAll,"onUpdate:checked":t[5]||(t[5]=o=>a(e).expandedAll=o),onChange:t[6]||(t[6]=o=>f.onExpandedAll())},{default:i(()=>[X]),_:1},8,["checked"])]),$("div",Z,[r(T,{expandedKeys:a(e).tree.expandedKeys,"onUpdate:expandedKeys":t[7]||(t[7]=o=>a(e).tree.expandedKeys=o),checkedKeys:a(e).tree.checkedKeys,"onUpdate:checkedKeys":t[8]||(t[8]=o=>a(e).tree.checkedKeys=o),checkable:"","tree-data":a(e).tree.data},null,8,["expandedKeys","checkedKeys","tree-data"])])])):H("",!0)]),_:1},8,["spinning"])]),_:1},8,["visible","bodyStyle"])}}};export{ae as default};
