import{d as j,r as h,b as M,c1 as B,f as s,o as i,l as S,w as t,u as o,a,U as p,j as n,I as H,J as I,c as y,g as L,T as V}from"./index-C9oHGpmd.js";import{T as q}from"./TimedTaskService-2_JrkzO6.js";import{_ as A}from"./GenerateCron.vue_vue_type_script_setup_true_lang-HSsOihAf.js";const D=L("a",{href:"https://qqe2.com/cron",target:"_blank"},"Cron表达式规则生成地址",-1),E={key:0,class:"text-danger"},G={key:1,class:"text-danger"},$=j({__name:"Info",props:{onSuccess:{type:Function}},setup(k,{expose:w}){const x=k;let e=h({open:!1,loading:!1,vm:{id:"",form:{}}});w({openWindow:(d="")=>{e.open=!0,e.vm.id=d,e.loading=!0,q.findForm(d).then(r=>{e.loading=!1,r.code==200&&(e.vm.form=r.data,e.vm.form.cron=e.vm.form.cron??"* * * * * ? *")})}});const U=M(),v={name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],groupName:[{required:!0,message:"请输入分组名称",trigger:"blur"}],cron:[{required:!0,message:"请输入定时规则",trigger:"blur"}],jobPoint:[{required:!0,message:"请输入作业点",trigger:"blur"}]},{validate:N,validateInfos:f}=B(e.vm.form,v);function C(){N().then(async d=>{e.loading=!0;const r=await q.saveForm(e.vm.id,e.vm.form);e.loading=!1,r.code==200&&(V.message.success("操作成功!"),x.onSuccess(),e.open=!1)}).then(d=>{console.log("Failed:",d),e.loading=!1})}return(d,r)=>{const c=s("a-input"),u=s("a-form-item"),m=s("a-select-option"),_=s("a-select"),g=s("a-textarea"),b=s("a-button"),F=s("a-form"),P=s("a-spin"),T=s("a-drawer");return i(),S(T,{open:o(e).open,"onUpdate:open":r[8]||(r[8]=l=>o(e).open=l),title:o(e).vm.id?"编辑":"新建",footer:!1,width:800},{default:t(()=>[a(P,{spinning:o(e).loading},{default:t(()=>[a(F,{ref_key:"refForm",ref:U,layout:"vertical",name:"custom-validation",model:o(e).vm.form,rules:v,class:"mt-24"},{default:t(()=>[a(u,p({required:"",label:"作业名称",name:"name"},o(f).name),{default:t(()=>[a(c,{value:o(e).vm.form.name,"onUpdate:value":r[0]||(r[0]=l=>o(e).vm.form.name=l),placeholder:"作业名称与触发器名称默认相同"},null,8,["value"])]),_:1},16),a(u,p({label:"分组",required:"",name:"groupName"},o(f).groupName),{default:t(()=>[a(c,{value:o(e).vm.form.groupName,"onUpdate:value":r[1]||(r[1]=l=>o(e).vm.form.groupName=l),placeholder:"分组名称与分组名称默认相同"},null,8,["value"])]),_:1},16),a(u,p({required:"",name:"cron"},o(f).cron),{label:t(()=>[n(" 间隔    "),D]),default:t(()=>[a(A,{value:o(e).vm.form.cron,"onUpdate:value":r[2]||(r[2]=l=>o(e).vm.form.cron=l)},null,8,["value"])]),_:1},16),a(u,{label:"任务类型",required:"",name:"type"},{default:t(()=>[a(_,{ref:"select",value:o(e).vm.form.type,"onUpdate:value":r[3]||(r[3]=l=>o(e).vm.form.type=l),placeholder:"请选择请求方式"},{default:t(()=>[a(m,{value:""},{default:t(()=>[n(" == 请选择任务类型 ==")]),_:1}),a(m,{value:1},{default:t(()=>[n("Memory 内存任务")]),_:1}),a(m,{value:2},{default:t(()=>[n("Memory 内存异步任务")]),_:1}),a(m,{value:3},{default:t(()=>[n(" Local 数据库任务 , 任务信息存储在数据库中 ， 根据 c# 命名空间 + 类名 + 方法名 作为任务名称 ")]),_:1}),a(m,{value:4},{default:t(()=>[n(" LocalAsync 数据库异步任务 , 任务信息存储在数据库中 ， 根据 c# 命名空间 + 类名 + 方法名 作为任务名称 ")]),_:1}),a(m,{value:5},{default:t(()=>[n("Http同步任务 - 网络http请求")]),_:1}),a(m,{value:6},{default:t(()=>[n("Http异步任务 - 网络http请求")]),_:1})]),_:1},8,["value"])]),_:1}),H(a(u,{label:"请求方式",required:"",name:"requestMode"},{default:t(()=>[a(_,{ref:"select",value:o(e).vm.form.requestMode,"onUpdate:value":r[4]||(r[4]=l=>o(e).vm.form.requestMode=l),placeholder:"请选择请求方式"},{default:t(()=>[a(m,{value:""},{default:t(()=>[n("== 请选择请求方式 ==")]),_:1}),a(m,{value:0},{default:t(()=>[n("Post")]),_:1}),a(m,{value:1},{default:t(()=>[n("Get")]),_:1}),a(m,{value:2},{default:t(()=>[n("Delete")]),_:1})]),_:1},8,["value"])]),_:1},512),[[I,o(e).vm.form.type===5||o(e).vm.form.type===6]]),a(u,p({required:"",name:"jobPoint"},o(f).jobPoint),{label:t(()=>[n(" 执行端点    "),o(e).vm.form.type===5||o(e).vm.form.type===6?(i(),y("span",E,"如果是Http任务请注意端点格式： http://www.baidu.com/api/v1/send-message")):(i(),y("span",G,"如果是Local任务请注意端点格式： 命名空间地址.类名称>函数名称 [例如：App.TestClass>Run]"))]),default:t(()=>[a(g,{value:o(e).vm.form.jobPoint,"onUpdate:value":r[5]||(r[5]=l=>o(e).vm.form.jobPoint=l),placeholder:"执行端点"},null,8,["value"])]),_:1},16),a(u,{label:"描述",name:"remark"},{default:t(()=>[a(g,{value:o(e).vm.form.remark,"onUpdate:value":r[6]||(r[6]=l=>o(e).vm.form.remark=l),placeholder:" 请添加任务描述"},null,8,["value"])]),_:1}),a(u,{class:"text-center"},{default:t(()=>[a(b,{type:"primary","html-type":"submit",onClick:C},{default:t(()=>[n("提交")]),_:1}),a(b,{class:"ml-10",onClick:r[7]||(r[7]=()=>o(e).open=!o(e).open)},{default:t(()=>[n("关闭")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])]),_:1},8,["open","title"])}}});export{$ as _};
