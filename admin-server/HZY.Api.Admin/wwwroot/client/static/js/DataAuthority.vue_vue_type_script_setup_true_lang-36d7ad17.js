var $=Object.defineProperty;var L=(d,s,o)=>s in d?$(d,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):d[s]=o;var g=(d,s,o)=>(L(d,typeof s!="symbol"?s+"":s,o),o);import{H as m,d as w,r as E,f as y,o as K,l as T,w as l,a as i,j as r,c as z,g as A,z as B,T as H}from"./index-2f681d41.js";import{S as P}from"./SysOrganizationService-bde1bf3b.js";class v{static findList(s,o,e={},h=[]){return m.post(`${this.urlPrefix}/findList`,{page:s,size:o,search:e,searchSort:h})}static deleteList(s){return m.post(`${this.urlPrefix}/deleteList`,s)}static findForm(s){return m.get(`${this.urlPrefix}/findForm${s?"/"+s:""}`)}static saveForm(s,o){return m.post(`${this.urlPrefix}/${s?"update":"create"}`,o)}static exportExcel(s={},o=[]){return m.download(`${this.urlPrefix}/exportExcel`,{page:-1,size:-1,search:s,searchSort:o})}static getDataAuthorityByRoleId(s){return m.get(`${this.urlPrefix}/getDataAuthorityByRoleId/${s}`)}}g(v,"urlPrefix","/api/v1/admin/SysDataAuthority");const S={key:0},I={class:"mb-15"},U={style:{"max-height":"280px","overflow-y":"auto"}},N=w({__name:"DataAuthority",props:{onSuccess:{type:Function}},setup(d,{expose:s}){const o=d,e=E({vm:{id:"",form:{sysDataAuthority:{},sysDataAuthorityCustomList:[]}},visible:!1,loading:!1,tree:{data:[],expandedKeys:[],selectedKeys:[],checkedKeys:[],allKeys:[],allExpandedKeys:[]},selectAll:!1,expandedAll:!1});s({open:(p="")=>{e.visible=!0,e.visible&&(e.vm.id=p),e.loading=!0,v.getDataAuthorityByRoleId(p).then(async t=>{if(e.loading=!1,t.code!=1)return;e.vm.form.sysDataAuthority=t.data.sysDataAuthority,e.vm.form.sysDataAuthority.roleId=p,e.vm.form.sysDataAuthorityCustomList=t.data.sysDataAuthorityCustomList;let n=(await P.sysOrganizationTree()).data;e.tree.data=n.rows,e.tree.expandedKeys=n.expandedRowKeys,e.tree.allKeys=n.allKeys,e.tree.allExpandedKeys=n.expandedRowKeys;var f=e.vm.form.sysDataAuthorityCustomList;for(let c=0;c<f.length;c++){const x=f[c];e.tree.checkedKeys.push(x.sysOrganizationId)}e.selectAll=e.tree.checkedKeys.length==e.tree.allKeys.length,e.expandedAll=e.tree.expandedKeys.length==e.tree.allExpandedKeys.length})}});async function h(){if(e.vm.form.sysDataAuthority.permissionType===1){var p=e.tree.checkedKeys;e.vm.form.sysDataAuthorityCustomList=[];for(let u=0;u<p.length;u++){const n=p[u];e.vm.form.sysDataAuthorityCustomList.push({sysOrganizationId:n})}}else e.vm.form.sysDataAuthorityCustomList=[];e.loading=!0,(await v.saveForm(e.vm.id,e.vm.form)).code==1&&(H.message.success("操作成功!"),o.onSuccess(),e.visible=!1)}function k(){e.selectAll?e.tree.checkedKeys=e.tree.allKeys:e.tree.checkedKeys=[]}function _(){e.expandedAll?e.tree.expandedKeys=e.tree.allExpandedKeys:e.tree.expandedKeys=[]}return(p,t)=>{const u=y("a-button"),n=y("a-radio"),f=y("a-radio-group"),c=y("a-divider"),x=y("a-checkbox"),D=y("a-tree"),b=y("a-spin"),C=y("a-modal");return K(),T(C,{visible:e.visible,"onUpdate:visible":t[11]||(t[11]=a=>e.visible=a),title:"数据权限设置",centered:"",onOk:t[12]||(t[12]=a=>e.visible=!1),width:400},{footer:l(()=>[i(u,{type:"primary",loading:e.loading,onClick:t[0]||(t[0]=a=>h())},{default:l(()=>[r(" 提交")]),_:1},8,["loading"]),i(u,{onClick:t[1]||(t[1]=a=>e.visible=!1)},{default:l(()=>[r("关闭")]),_:1})]),default:l(()=>[i(b,{spinning:e.loading},{default:l(()=>[i(f,{value:e.vm.form.sysDataAuthority.permissionType,"onUpdate:value":t[2]||(t[2]=a=>e.vm.form.sysDataAuthority.permissionType=a)},{default:l(()=>[i(n,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:1},{default:l(()=>[r("自定义权限")]),_:1}),i(n,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:2},{default:l(()=>[r("查看所有数据")]),_:1}),i(n,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:3},{default:l(()=>[r("仅查看本组织")]),_:1}),i(n,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:4},{default:l(()=>[r("仅查看本组织和下属组织")]),_:1}),i(n,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:5},{default:l(()=>[r("仅查看本人")]),_:1})]),_:1},8,["value"]),e.vm.form.sysDataAuthority.permissionType===1?(K(),z("div",S,[i(c,null,{default:l(()=>[r("自定义数据权限")]),_:1}),A("div",I,[i(x,{checked:e.selectAll,"onUpdate:checked":t[3]||(t[3]=a=>e.selectAll=a),onChange:t[4]||(t[4]=a=>k())},{default:l(()=>[r("全选/全不选")]),_:1},8,["checked"]),i(x,{checked:e.expandedAll,"onUpdate:checked":t[5]||(t[5]=a=>e.expandedAll=a),onChange:t[6]||(t[6]=a=>_())},{default:l(()=>[r("展开/折叠")]),_:1},8,["checked"])]),A("div",U,[i(D,{expandedKeys:e.tree.expandedKeys,"onUpdate:expandedKeys":t[7]||(t[7]=a=>e.tree.expandedKeys=a),checkedKeys:e.tree.checkedKeys,"onUpdate:checkedKeys":t[8]||(t[8]=a=>e.tree.checkedKeys=a),onCheck:t[9]||(t[9]=a=>e.selectAll=a.length==e.tree.allKeys.length),onExpand:t[10]||(t[10]=a=>e.expandedAll=a.length==e.tree.allExpandedKeys.length),checkable:"","tree-data":e.tree.data},null,8,["expandedKeys","checkedKeys","tree-data"])])])):B("",!0)]),_:1},8,["spinning"])]),_:1},8,["visible"])}}});export{N as _};
