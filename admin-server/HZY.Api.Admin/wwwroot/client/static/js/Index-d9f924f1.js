import{d as T,r as G,L as H,b as x,e as Q,f as r,o as l,l as m,w as o,a as n,u as c,i as u,x as f,c as v,B,t as W,F,M as X,g as j,T as O,y as Y,j as Z}from"./index-ceef6588.js";import{_ as g}from"./AppIcon.vue_vue_type_script_setup_true_lang-081834dc.js";import{M as C,_ as ee}from"./Info.vue_vue_type_script_setup_true_lang-5c06918f.js";import{_ as te}from"./PageContainer.vue_vue_type_script_setup_true_lang-f7d2786e.js";import{_ as oe}from"./TableCurd.vue_vue_type_script_setup_true_lang-3a6845a0.js";import"./WangEditor.vue_vue_type_script_setup_true_lang-3721e649.js";import"./FindBack-e2069a83.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./Index.vue_vue_type_script_setup_true_lang-c441ce5d.js";import"./Info.vue_vue_type_script_setup_true_lang-b78f12e0.js";import"./SysOrganizationService-6f709c8d.js";const ae={key:0},ne={key:1},se=["src"],re=["onClick"],le=["onClick"],ie=j("a",{class:"text-danger"},"删除",-1),de=T({name:"base_member"}),Ce=T({...de,setup(ce){const t=G({search:{state:!1,vm:{name:void 0},sort:[]},loading:!1,page:1,size:10,total:100,columns:[],data:[]}),d=H(),b=x(),h=x(),w=x();Q(()=>{_()});async function _(){try{t.loading=!0;const s=await C.findList(t.page,t.size,t.search.vm,t.search.sort);if(t.loading=!1,s.code!=1)return;t.page=s.data.page,t.size=s.data.size,t.total=s.data.total,t.columns=s.data.columns,t.data=s.data.dataSource}catch{t.loading=!1}}async function S(s){var k;let a=[];if(s?a.push(s):a=((k=b.value)==null?void 0:k.getSelectedRowKeys())??[],a.length==0)return O.message.error("请选择要删除的行!");try{t.loading=!0;const y=await C.deleteList(a);if(t.loading=!1,y.code!=1)return;O.message.success("删除成功!"),_()}catch{t.loading=!1}}function D(){C.exportExcel(t.search.vm,t.search.sort)}function E(s){if(s){var a=JSON.parse(s);return Y.domainServerApi+(a.length>0?a[0].url:"")}}function M(s){Z.push(`/base/member/details/${s.id}/${s.name}`)}return(s,a)=>{const k=r("a-input"),y=r("a-form-item"),$=r("a-col"),p=r("a-button"),U=r("a-space"),V=r("a-row"),A=r("a-form"),z=r("a-popconfirm"),I=r("a-menu-item"),P=r("a-menu"),J=r("a-dropdown"),K=r("a-checkbox"),R=r("a-popover"),N=r("a-table-column"),L=r("a-divider");return l(),m(te,null,{default:o(()=>[n(oe,{ref_key:"refTableCurd",ref:b,config:t,onChange:a[7]||(a[7]=e=>{t.page=e.pagination.current??1,t.size=e.pagination.pageSize??t.size,t.search.sort=e.sorter instanceof Array?[...e.sorter]:[e.sorter],_()}),onShowSizeChange:a[8]||(a[8]=({current:e,size:i})=>{t.page=e==0?1:e,t.size=i,_()})},{search:o(()=>[c(d).search?(l(),m(A,{key:0,ref_key:"refSearchForm",ref:w,model:t.search.vm},{default:o(()=>[n(V,{gutter:[16,0]},{default:o(()=>[n($,{xs:24,sm:12,md:8,lg:6,xl:6},{default:o(()=>[n(y,{class:"mb-0",name:"name",label:"名称"},{default:o(()=>[n(k,{value:t.search.vm.name,"onUpdate:value":a[0]||(a[0]=e=>t.search.vm.name=e),placeholder:"名称"},null,8,["value"])]),_:1})]),_:1}),n($,{xs:24,sm:12,md:8,lg:6,xl:6,class:"text-right"},{default:o(()=>[n(U,{size:8},{default:o(()=>[n(p,{onClick:a[1]||(a[1]=e=>{var i;t.page=1,(i=w.value)==null||i.resetFields(),_()})},{default:o(()=>[u(" 重置 ")]),_:1}),n(p,{type:"primary",onClick:a[2]||(a[2]=e=>{t.page=1,_()})},{default:o(()=>[u(" 查询 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])):f("",!0)]),"toolbar-left":o(()=>[c(d).search?(l(),m(p,{key:0,onClick:a[3]||(a[3]=e=>t.search.state=!t.search.state)},{default:o(()=>[t.search.state?(l(),v("div",ae,[n(g,{name:"UpOutlined"}),u("  收起")])):(l(),v("div",ne,[n(g,{name:"DownOutlined"}),u("  展开")]))]),_:1})):f("",!0),c(d).insert?(l(),m(p,{key:1,type:"primary",onClick:a[4]||(a[4]=()=>{var e;return(e=h.value)==null?void 0:e.open()})},{icon:o(()=>[n(g,{name:"PlusOutlined"})]),default:o(()=>[u(" 新建 ")]),_:1})):f("",!0),c(d).delete?(l(),m(z,{key:2,title:"您确定要删除?",onConfirm:a[5]||(a[5]=e=>S()),okText:"确定",cancelText:"取消"},{default:o(()=>[n(p,{type:"primary",danger:""},{icon:o(()=>[n(g,{name:"DeleteOutlined"})]),default:o(()=>[u(" 批量删除 ")]),_:1})]),_:1})):f("",!0)]),"toolbar-right":o(()=>[n(J,null,{overlay:o(()=>[n(P,null,{default:o(()=>[n(I,{key:"1",onClick:a[6]||(a[6]=e=>D())},{default:o(()=>[u("导出 Excel")]),_:1})]),_:1})]),default:o(()=>[n(p,null,{default:o(()=>[u(" 更多 "),n(g,{name:"ellipsis-outlined"})]),_:1})]),_:1}),n(R,null,{content:o(()=>[(l(!0),v(F,null,B(t.columns.filter(e=>e.fieldName.substr(0,1)!="_"),e=>(l(),v("div",null,[n(K,{checked:e.show,"onUpdate:checked":i=>e.show=i},{default:o(()=>[u(W(e.title),1)]),_:2},1032,["checked","onUpdate:checked"])]))),256))]),default:o(()=>[n(p,{type:"text"},{icon:o(()=>[n(g,{name:"setting-outlined"})]),_:1})]),_:1})]),"table-col":o(()=>[(l(!0),v(F,null,B(t.columns.filter(e=>e.fieldName!=="id"&&e.show),(e,i)=>(l(),m(N,{key:e.fieldName,title:e.title,"data-index":e.fieldName,sorter:e.sort?{multiple:i+1}:!1},X({_:2},[e.fieldName=="photo"?{name:"default",fn:o(({record:q})=>[j("img",{src:E(q.photo),width:"35",height:"35"},null,8,se)]),key:"0"}:void 0]),1032,["title","data-index","sorter"]))),128)),c(d).update||c(d).delete?(l(),m(N,{key:0,title:"操作","data-index":"id"},{default:o(({record:e})=>[c(d).update?(l(),v("a",{key:0,href:"javascript:void(0)",onClick:i=>M(e)},"详情",8,re)):f("",!0),n(L,{type:"vertical"}),c(d).update?(l(),v("a",{key:1,href:"javascript:;",onClick:()=>{var i;return(i=h.value)==null?void 0:i.open(e.id)}},"编辑",8,le)):f("",!0),n(L,{type:"vertical"}),c(d).delete?(l(),m(z,{key:2,title:"您确定要删除?",onConfirm:i=>S(e.id),okText:"确定",cancelText:"取消"},{default:o(()=>[ie]),_:2},1032,["onConfirm"])):f("",!0)]),_:1})):f("",!0)]),_:1},8,["config"]),n(ee,{ref_key:"refInfo",ref:h,onSuccess:()=>_()},null,8,["onSuccess"])]),_:1})}}});export{Ce as default};
