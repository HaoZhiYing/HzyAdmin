var b=Object.defineProperty;var B=(d,s,n)=>s in d?b(d,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):d[s]=n;var v=(d,s,n)=>(B(d,typeof s!="symbol"?s+"":s,n),n);import{S as m,d as L,x as $,r,o as g,e as w,w as l,a as i,j as u,c as F,f as A,i as S,m as P}from"./index-1050b563.js";import{S as T}from"./SysOrganizationService-56f56fbf.js";class h{static findList(s,n,e={}){return m.post(`${this.urlPrefix}/findList/${n}/${s}`,e)}static deleteList(s){return m.post(`${this.urlPrefix}/deleteList`,s)}static findForm(s){return m.get(`${this.urlPrefix}/findForm${s?"/"+s:""}`)}static saveForm(s,n){return m.post(`${this.urlPrefix}/${s?"update":"create"}`,n)}static exportExcel(s={}){return m.download(`${this.urlPrefix}/exportExcel`,s)}static getDataAuthorityByRoleId(s){return m.get(`${this.urlPrefix}/getDataAuthorityByRoleId/${s}`)}}v(h,"urlPrefix","/api/admin/SysDataAuthority");const H={key:0},U={class:"mb-15"},I={style:{"max-height":"280px","overflow-y":"auto"}},N=L({__name:"DataAuthority",props:{onSuccess:{type:Function}},setup(d,{expose:s}){const n=d,e=$({vm:{id:"",form:{sysDataAuthority:{},sysDataAuthorityCustomList:[]}},visible:!1,saveLoading:!1,tree:{data:[],expandedKeys:[],selectedKeys:[],checkedKeys:[],allKeys:[],allExpandedKeys:[]},selectAll:!1,expandedAll:!1});s({open:(p="")=>{e.visible=!0,e.visible&&(e.vm.id=p),e.saveLoading=!0,h.getDataAuthorityByRoleId(p).then(async t=>{if(e.saveLoading=!1,t.code!=1)return;e.vm.form.sysDataAuthority=t.data.sysDataAuthority,e.vm.form.sysDataAuthorityCustomList=t.data.sysDataAuthorityCustomList;let o=(await T.sysOrganizationTree()).data;e.tree.data=o.rows,e.tree.expandedKeys=o.expandedRowKeys,e.tree.allKeys=o.allKeys,e.tree.allExpandedKeys=o.expandedRowKeys;var f=e.vm.form.sysDataAuthorityCustomList;for(let c=0;c<f.length;c++){const x=f[c];e.tree.checkedKeys.push(x.sysOrganizationId)}e.selectAll=e.tree.checkedKeys.length==e.tree.allKeys.length,e.expandedAll=e.tree.expandedKeys.length==e.tree.allExpandedKeys.length})}});async function E(){if(e.vm.form.sysDataAuthority.permissionType===1){var p=e.tree.checkedKeys;e.vm.form.sysDataAuthorityCustomList=[];for(let y=0;y<p.length;y++){const o=p[y];e.vm.form.sysDataAuthorityCustomList.push({sysOrganizationId:o})}}else e.vm.form.sysDataAuthorityCustomList=[];e.saveLoading=!0,(await h.saveForm(e.vm.id,e.vm)).code==1&&(P.message.success("\u64CD\u4F5C\u6210\u529F!"),n.onSuccess(),e.visible=!1)}function K(){e.selectAll?e.tree.checkedKeys=e.tree.allKeys:e.tree.checkedKeys=[]}function C(){e.expandedAll?e.tree.expandedKeys=e.tree.allExpandedKeys:e.tree.expandedKeys=[]}return(p,t)=>{const y=r("a-button"),o=r("a-radio"),f=r("a-radio-group"),c=r("a-divider"),x=r("a-checkbox"),k=r("a-tree"),_=r("a-spin"),D=r("a-modal");return g(),w(D,{visible:e.visible,"onUpdate:visible":t[11]||(t[11]=a=>e.visible=a),title:"\u6570\u636E\u6743\u9650\u8BBE\u7F6E",centered:"",onOk:t[12]||(t[12]=a=>e.visible=!1),width:400},{footer:l(()=>[i(y,{type:"primary",loading:e.saveLoading,onClick:t[0]||(t[0]=a=>E())},{default:l(()=>[u(" \u63D0\u4EA4")]),_:1},8,["loading"]),i(y,{onClick:t[1]||(t[1]=a=>e.visible=!1)},{default:l(()=>[u("\u5173\u95ED")]),_:1})]),default:l(()=>[i(_,{spinning:e.saveLoading},{default:l(()=>[i(f,{value:e.vm.form.sysDataAuthority.permissionType,"onUpdate:value":t[2]||(t[2]=a=>e.vm.form.sysDataAuthority.permissionType=a)},{default:l(()=>[i(o,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:1},{default:l(()=>[u("\u81EA\u5B9A\u4E49\u6743\u9650")]),_:1}),i(o,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:2},{default:l(()=>[u("\u67E5\u770B\u6240\u6709\u6570\u636E")]),_:1}),i(o,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:3},{default:l(()=>[u("\u4EC5\u67E5\u770B\u672C\u7EC4\u7EC7")]),_:1}),i(o,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:4},{default:l(()=>[u("\u4EC5\u67E5\u770B\u672C\u7EC4\u7EC7\u548C\u4E0B\u5C5E\u7EC4\u7EC7")]),_:1}),i(o,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:5},{default:l(()=>[u("\u4EC5\u67E5\u770B\u672C\u4EBA")]),_:1})]),_:1},8,["value"]),e.vm.form.sysDataAuthority.permissionType===1?(g(),F("div",H,[i(c,null,{default:l(()=>[u("\u81EA\u5B9A\u4E49\u6570\u636E\u6743\u9650")]),_:1}),A("div",U,[i(x,{checked:e.selectAll,"onUpdate:checked":t[3]||(t[3]=a=>e.selectAll=a),onChange:t[4]||(t[4]=a=>K())},{default:l(()=>[u("\u5168\u9009/\u5168\u4E0D\u9009")]),_:1},8,["checked"]),i(x,{checked:e.expandedAll,"onUpdate:checked":t[5]||(t[5]=a=>e.expandedAll=a),onChange:t[6]||(t[6]=a=>C())},{default:l(()=>[u("\u5C55\u5F00/\u6298\u53E0")]),_:1},8,["checked"])]),A("div",I,[i(k,{expandedKeys:e.tree.expandedKeys,"onUpdate:expandedKeys":t[7]||(t[7]=a=>e.tree.expandedKeys=a),checkedKeys:e.tree.checkedKeys,"onUpdate:checkedKeys":t[8]||(t[8]=a=>e.tree.checkedKeys=a),onCheck:t[9]||(t[9]=a=>e.selectAll=a.length==e.tree.allKeys.length),onExpand:t[10]||(t[10]=a=>e.expandedAll=a.length==e.tree.allExpandedKeys.length),checkable:"","tree-data":e.tree.data},null,8,["expandedKeys","checkedKeys","tree-data"])])])):S("",!0)]),_:1},8,["spinning"])]),_:1},8,["visible"])}}});export{N as _};
