import{p as k,aT as $,r as L,a as N,j as u,T as S,k as h,q as _,w as c,g,L as U,d as M,e as b,C as x,c as C,x as E,F as V,n as F,aS as D,t as I}from"./index-3c68c560.js";const m="admin/SysRoleMenuFunction";var y={findList(d,p,n={}){return k(`${m}/findList/${d}/${p}`,n,!1)},saveForm(d){return d.id?k(`${m}/update`,d):k(`${m}/create`,d)},getRoleMenuFunctionByRoleId(d){return $(`${m}/getRoleMenuFunctionByRoleId/${d}`)}};const z=M("span",{class:"mr-15"},"\u89D2\u8272\u529F\u80FD\u8BBE\u7F6E",-1),j=F("\u4FDD\u5B58/\u63D0\u4EA4"),q={class:"mr-15"},H=F(" \u5168\u9009 "),W={__name:"RoleFunction",setup(d,{expose:p}){const n=L({roleId:"",data:[],loading:!1,visible:!1}),f=N(null),r={getRoleMenuFunctionTree(){n.loading=!0,y.getRoleMenuFunctionByRoleId(n.roleId).then(a=>{n.loading=!1;let e=a.data;n.data=e,D(()=>{for(var l=0;l<n.data.length;l++){var s=n.data[l];if(s.menuFunctions.length>0){var i=s.levelCode.substr(0,s.levelCode.lastIndexOf("."));f.value.setTreeExpand(n.data.filter(v=>v.levelCode==i),!0)}}})})},save(){for(var a=n.data.filter(i=>i.menuFunctions.length>0),e=[],l=0;l<a.length;l++){var s=a[l];e.push({roleId:n.roleId,menuId:s.id,menuFunctionIdList:s.checkedMenuFunctionIds})}y.saveForm(e).then(i=>{if(i.code!=1)return I.message("\u4FDD\u5B58\u5931\u8D25!","\u9519\u8BEF");r.getRoleMenuFunctionTree(),I.message("\u4FDD\u5B58\u6210\u529F!","\u6210\u529F")})},onChangeCheckbox({values:a,row:e}){e.indeterminate=!!a.length&&a.length<e.menuFunctions.length,e.checkAll=a.length===e.menuFunctions.length},openWindow({visible:a,key:e}){n.visible=a,n.roleId=e,r.getRoleMenuFunctionTree()},setAllTreeExpand(){f.value.setAllTreeExpand(!0)},onCheckAllChange(a,e){a.target.checked?(e.checkedMenuFunctionIds=e.menuFunctions.map(l=>l.id),e.indeterminate=e.checkedMenuFunctionIds.length>0&&e.checkedMenuFunctionIds.length<e.menuFunctions.length,e.checkAll=e.checkedMenuFunctionIds.length===e.menuFunctions.length):(e.checkedMenuFunctionIds=[],e.indeterminate=!1)}};return p({...r}),(a,e)=>{const l=u("a-button"),s=u("a-checkbox"),i=u("vxe-column"),v=u("a-checkbox-group"),T=u("vxe-table"),R=u("a-spin"),A=u("a-modal"),B=S("drag");return h(),_(A,{visible:n.visible,"onUpdate:visible":e[0]||(e[0]=t=>n.visible=t),centered:"",width:"1200px",bodyStyle:{overflowY:"auto",height:"calc(100vh - 100px)"},footer:null},{title:c(()=>[z,g(l,{type:"primary",onClick:r.save},{default:c(()=>[j]),_:1},8,["onClick"])]),default:c(()=>[U((h(),_(R,{spinning:n.loading},{default:c(()=>[g(T,{ref_key:"refTable",ref:f,resizable:"",data:n.data,"row-config":{isHover:!0},"tree-config":{transform:!0,rowField:"id",parentField:"parentId"},size:"small"},{default:c(()=>[g(i,{field:"name",title:"\u83DC\u5355\u540D\u79F0","tree-node":"",width:"250"},{default:c(({row:t})=>[M("span",q,b(t.name),1),t.menuFunctions.length>0?(h(),_(s,{key:0,checked:t.checkAll,"onUpdate:checked":o=>t.checkAll=o,indeterminate:t.indeterminate,onChange:o=>r.onCheckAllChange(o,t)},{default:c(()=>[H]),_:2},1032,["checked","onUpdate:checked","indeterminate","onChange"])):x("",!0)]),_:1}),g(i,{field:"id",title:"\u6743\u9650"},{default:c(({row:t})=>[t.menuFunctions.length>0?(h(),_(v,{key:0,style:{display:"block"},value:t.checkedMenuFunctionIds,"onUpdate:value":o=>t.checkedMenuFunctionIds=o,onChange:o=>r.onChangeCheckbox({values:o,row:t})},{default:c(()=>[(h(!0),C(V,null,E(t.menuFunctions,o=>(h(),C("span",{key:o.id,class:"mr-15"},[g(s,{value:o.id},{default:c(()=>[F(b(o.label),1)]),_:2},1032,["value"])]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):x("",!0)]),_:1})]),_:1},8,["data"])]),_:1},8,["spinning"])),[[B]])]),_:1},8,["visible","bodyStyle"])}}};export{W as default};
