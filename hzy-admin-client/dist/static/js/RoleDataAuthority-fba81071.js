import{p as h,t as x,aT as v,aU as w,r as I,I as K,j as r,T as E,k as g,q as A,w as l,g as n,L as S,c as F,d as k,C as B,n as d}from"./index-3c68c560.js";import{o as U}from"./organizationService-73a6c5a7.js";const p="admin/SysDataAuthority";var D={findList(s,u,f={}){return h(`${p}/findList/${s}/${u}`,f,!1)},deleteList(s){return console.log(s),s&&s.length===0?x.message("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u6570\u636E!","\u8B66\u544A"):h(`${p}/deleteList`,s,!1)},findForm(s){return v(`${p}/findForm${s?"/"+s:""}`)},saveForm(s){return s.id?h(`${p}/update`,s):h(`${p}/create`,s)},exportExcel(s){return w(`${p}/exportExcel`,s)},getDataAuthorityByRoleId(s){return v(`${p}/getDataAuthorityByRoleId/${s}`)}};const z=d("\u63D0\u4EA4"),O=d("\u5173\u95ED"),R=d("\u81EA\u5B9A\u4E49\u6743\u9650"),H=d("\u67E5\u770B\u6240\u6709\u6570\u636E"),N=d("\u4EC5\u67E5\u770B\u672C\u7EC4\u7EC7"),V=d("\u4EC5\u67E5\u770B\u672C\u7EC4\u7EC7\u548C\u4E0B\u5C5E\u7EC4\u7EC7"),j=d("\u4EC5\u67E5\u770B\u672C\u4EBA"),q={key:0},W=d("\u81EA\u5B9A\u4E49\u6570\u636E\u6743\u9650"),Y={class:"mb-15"},G=d("\u5168\u9009/\u5168\u4E0D\u9009"),J=d("\u5C55\u5F00/\u6298\u53E0"),M={style:{"max-height":"280px","overflow-y":"auto"}},X={__name:"RoleDataAuthority",emits:["onSuccess"],setup(s,{expose:u,emit:f}){const e=I({roleId:"",loading:!1,visible:!1,form:{sysDataAuthority:{},sysDataAuthorityCustomList:[]},selectAll:!1,expandedAll:!1,tree:{data:[],expandedKeys:[],selectedKeys:[],checkedKeys:[],allKeys:[],allExpandedKeys:[],loadingTree:!1}}),c={openWindow({visible:o,key:t}){e.visible=o,e.roleId=t,this.findForm()},findForm(){e.saveLoading=!0,D.getDataAuthorityByRoleId(e.roleId).then(o=>{e.saveLoading=!1,o.code==1&&(e.form=o.data,e.form.sysDataAuthority.roleId=e.roleId,this.sysOrganizationTree())})},sysOrganizationTree(){e.tree.loadingTree=!0,e.tree.checkedKeys=[],U.sysOrganizationTree().then(o=>{e.tree.loadingTree=!1;let t=o.data;e.tree.data=t.rows,e.tree.expandedKeys=t.expandedRowKeys,e.tree.allKeys=t.allKeys,e.tree.allExpandedKeys=t.expandedRowKeys;var y=e.form.sysDataAuthorityCustomList;for(let i=0;i<y.length;i++){const m=y[i];e.tree.checkedKeys.push(m.sysOrganizationId)}e.selectAll=e.tree.checkedKeys.length==e.tree.allKeys.length,e.expandedAll=e.tree.expandedKeys.length==e.tree.allExpandedKeys.length})},saveForm(){if(e.form.sysDataAuthority.permissionType===1){var o=e.tree.checkedKeys;e.form.sysDataAuthorityCustomList=[];for(let t=0;t<o.length;t++){const y=o[t];e.form.sysDataAuthorityCustomList.push({sysOrganizationId:y})}}else e.form.sysDataAuthorityCustomList=[];D.saveForm(e.form).then(t=>{if(t.code!=1)return x.message("\u4FDD\u5B58\u5931\u8D25!","\u9519\u8BEF");e.visible=!1,console.log(1231231312),x.message("\u4FDD\u5B58\u6210\u529F!","\u6210\u529F"),f("onSuccess",t.data)})},onSelectAll(){e.selectAll?e.tree.checkedKeys=e.tree.allKeys:e.tree.checkedKeys=[]},onExpandedAll(){e.expandedAll?e.tree.expandedKeys=e.tree.allExpandedKeys:e.tree.expandedKeys=[]}};return K(()=>e.tree.checkedKeys,o=>{console.log("checkedKeys",o),e.selectAll=o.length==e.tree.allKeys.length}),K(()=>e.tree.expandedKeys,o=>{e.expandedAll=o.length==e.tree.allExpandedKeys.length}),u({...c}),(o,t)=>{const y=r("a-button"),i=r("a-radio"),m=r("a-radio-group"),b=r("a-divider"),_=r("a-checkbox"),$=r("a-tree"),C=r("a-spin"),L=r("a-modal"),T=E("drag");return g(),A(L,{visible:e.visible,"onUpdate:visible":t[9]||(t[9]=a=>e.visible=a),title:"\u6570\u636E\u6743\u9650\u8BBE\u7F6E",centered:"",onOk:t[10]||(t[10]=a=>e.visible=!1),width:400,bodyStyle:{overflowY:"auto",height:"calc(100vh - 300px)"}},{footer:l(()=>[n(y,{type:"primary",onClick:t[0]||(t[0]=a=>c.saveForm()),loading:e.saveLoading},{default:l(()=>[z]),_:1},8,["loading"]),n(y,{type:"danger",ghost:"",onClick:t[1]||(t[1]=a=>e.visible=!1),class:"ml-15"},{default:l(()=>[O]),_:1})]),default:l(()=>[S((g(),A(C,{spinning:e.loading},{default:l(()=>[n(m,{value:e.form.sysDataAuthority.permissionType,"onUpdate:value":t[2]||(t[2]=a=>e.form.sysDataAuthority.permissionType=a)},{default:l(()=>[n(i,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:1},{default:l(()=>[R]),_:1}),n(i,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:2},{default:l(()=>[H]),_:1}),n(i,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:3},{default:l(()=>[N]),_:1}),n(i,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:4},{default:l(()=>[V]),_:1}),n(i,{style:{display:"flex",height:"30px",lineHeight:"30px"},value:5},{default:l(()=>[j]),_:1})]),_:1},8,["value"]),e.form.sysDataAuthority.permissionType===1?(g(),F("div",q,[n(b,null,{default:l(()=>[W]),_:1}),k("div",Y,[n(_,{checked:e.selectAll,"onUpdate:checked":t[3]||(t[3]=a=>e.selectAll=a),onChange:t[4]||(t[4]=a=>c.onSelectAll())},{default:l(()=>[G]),_:1},8,["checked"]),n(_,{checked:e.expandedAll,"onUpdate:checked":t[5]||(t[5]=a=>e.expandedAll=a),onChange:t[6]||(t[6]=a=>c.onExpandedAll())},{default:l(()=>[J]),_:1},8,["checked"])]),k("div",M,[n($,{expandedKeys:e.tree.expandedKeys,"onUpdate:expandedKeys":t[7]||(t[7]=a=>e.tree.expandedKeys=a),checkedKeys:e.tree.checkedKeys,"onUpdate:checkedKeys":t[8]||(t[8]=a=>e.tree.checkedKeys=a),checkable:"","tree-data":e.tree.data},null,8,["expandedKeys","checkedKeys","tree-data"])])])):B("",!0)]),_:1},8,["spinning"])),[[T]])]),_:1},8,["visible","bodyStyle"])}}};export{X as default};
