import{d as U,y as X,a4 as Y,C as E,b as Z,q as ee,a6 as D,s as te,m as F,r as u,o as r,e as f,w as o,a as n,u as g,i as m,l as v,c as w,j as N,t as ae,F as O,f as oe}from"./index-0b0c7006.js";import{_ as k}from"./AppIcon.vue_vue_type_script_setup_true_lang-14707d57.js";import{_ as ne}from"./Info.vue_vue_type_script_setup_true_lang-1b3ded18.js";import{_ as se}from"./PageContainer.vue_vue_type_script_setup_true_lang-79d7f1c7.js";import{_ as ue}from"./TableCurd.vue_vue_type_script_setup_true_lang-5b25c5de.js";import{S as le}from"./SysOrganizationService-222012f9.js";const re={key:0},ie={key:1},de=["onClick"],ce=oe("a",{class:"text-danger"},"\u5220\u9664",-1),me=U({name:"system_user"}),ke=U({...me,props:{isFindBack:{type:Boolean,default:!1},defaultRowIds:null,type:{type:Boolean,default:!0}},emits:["findBackChange"],setup(T,{emit:L}){const h=T,t=X({search:{state:!1,vm:{name:void 0,loginName:void 0,organizationId:void 0},sort:[]},loading:!1,page:1,size:10,total:100,columns:[],data:[]}),p=Y(),C=E(),B=E(),S=E(),z=E(),K=E({defaultRowIds:Z(()=>h.defaultRowIds)});ee(()=>{y(),le.sysOrganizationTree().then(s=>{z.value=s.data.rows})});async function y(){try{t.loading=!0;const s=await D.findList(t.page,t.size,t.search.vm,t.search.sort);if(t.loading=!1,s.code!=1)return;t.page=s.data.page,t.size=s.data.size,t.total=s.data.total,t.columns=s.data.columns,t.data=s.data.dataSource,x.setCheckboxRow()}catch{t.loading=!1}}async function A(s){var i,d;let a=[];if(s?a.push(s):a=(d=(i=C.value)==null?void 0:i.getSelectedRowKeys())!=null?d:[],a.length==0)return F.message.error("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u884C!");try{t.loading=!0;const c=await D.deleteList(a);if(t.loading=!1,c.code!=1)return;F.message.success("\u5220\u9664\u6210\u529F!"),y()}catch{t.loading=!1}}function V(){D.exportExcel(t.search.vm,t.search.sort)}const x={initRows(){!h.isFindBack||te(()=>h.defaultRowIds,s=>{x.setCheckboxRow()})},setCheckboxRow(){var s,a;!h.isFindBack||((s=C.value)==null||s.clearSelectedRowKeys(),(a=C.value)==null||a.setSelectedRowKeys(K.value.defaultRowIds))},onChange(){var a,i;if(!!h.isFindBack){var s=(i=(a=C.value)==null?void 0:a.getSelectedRowKeys())!=null?i:[];if(s&&s.length==0)return F.message.warning("\u8BF7\u9009\u62E9\u4E00\u6761\u6570\u636E!");if(h.type&&s.length>1)return F.message.warning("\u53EA\u80FD\u9009\u62E9\u4E00\u6761\u6570\u636E!");L("findBackChange",x.getRowsByIds(s))}},getRowsByIds(s){var a=[],i=t.data;for(let d=0;d<i.length;d++){const c=i[d];s.filter(b=>b==c.id).length>0&&a.push(c)}return a}};return x.initRows(),(s,a)=>{const i=u("a-input"),d=u("a-form-item"),c=u("a-col"),b=u("a-tree-select"),_=u("a-button"),j=u("a-space"),M=u("a-row"),q=u("a-form"),R=u("a-popconfirm"),H=u("a-menu-item"),P=u("a-menu"),G=u("a-dropdown"),J=u("a-checkbox"),Q=u("a-popover"),I=u("a-table-column"),W=u("a-divider");return r(),f(se,{show:!s.$props.isFindBack},{default:o(()=>[n(ue,{ref_key:"refTableCurd",ref:C,config:t,onChange:a[10]||(a[10]=e=>{var l,$;t.page=(l=e.pagination.current)!=null?l:1,t.size=($=e.pagination.pageSize)!=null?$:t.size,t.search.sort=e.sorter instanceof Array?[...e.sorter]:[e.sorter],y()}),onShowSizeChange:a[11]||(a[11]=({current:e,size:l})=>{t.page=e==0?1:e,t.size=l,y()})},{search:o(()=>[g(p).search?(r(),f(q,{key:0,ref_key:"refSearchForm",ref:S,model:t.search.vm},{default:o(()=>[n(M,{gutter:[16,0]},{default:o(()=>[n(c,{xs:24,sm:12,md:8,lg:6,xl:6},{default:o(()=>[n(d,{class:"mb-0",name:"name",label:"\u771F\u5B9E\u59D3\u540D"},{default:o(()=>[n(i,{value:t.search.vm.name,"onUpdate:value":a[0]||(a[0]=e=>t.search.vm.name=e),placeholder:"\u771F\u5B9E\u540D\u79F0"},null,8,["value"])]),_:1})]),_:1}),n(c,{xs:24,sm:12,md:8,lg:6,xl:6},{default:o(()=>[n(d,{class:"mb-0",name:"loginName",label:"\u8D26\u6237\u540D\u79F0"},{default:o(()=>[n(i,{value:t.search.vm.loginName,"onUpdate:value":a[1]||(a[1]=e=>t.search.vm.loginName=e),placeholder:"\u8D26\u6237\u540D\u79F0"},null,8,["value"])]),_:1})]),_:1}),n(c,{xs:24,sm:12,md:8,lg:6,xl:6},{default:o(()=>[n(d,{class:"mb-0",name:"organizationId",label:"\u6240\u5C5E\u7EC4\u7EC7"},{default:o(()=>[n(b,{value:t.search.vm.organizationId,"onUpdate:value":a[2]||(a[2]=e=>t.search.vm.organizationId=e),"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"\u6240\u5C5E\u7EC4\u7EC7","allow-clear":"","tree-default-expand-all":"","tree-data":z.value,"field-names":{children:"children",label:"title",value:"key"},class:"w100"},null,8,["value","tree-data"])]),_:1})]),_:1}),n(c,{xs:24,sm:12,md:8,lg:6,xl:6,class:"text-right"},{default:o(()=>[n(j,{size:8},{default:o(()=>[n(_,{onClick:a[3]||(a[3]=e=>{var l;t.page=1,(l=S.value)==null||l.resetFields(),y()})},{default:o(()=>[m(" \u91CD\u7F6E ")]),_:1}),n(_,{type:"primary",onClick:a[4]||(a[4]=e=>{t.page=1,y()})},{default:o(()=>[m(" \u67E5\u8BE2 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])):v("",!0)]),"toolbar-left":o(()=>[g(p).search?(r(),f(_,{key:0,onClick:a[5]||(a[5]=e=>t.search.state=!t.search.state)},{default:o(()=>[t.search.state?(r(),w("div",re,[n(k,{name:"UpOutlined"}),m("\xA0\xA0\u6536\u8D77")])):(r(),w("div",ie,[n(k,{name:"DownOutlined"}),m("\xA0\xA0\u5C55\u5F00")]))]),_:1})):v("",!0),g(p).insert?(r(),f(_,{key:1,type:"primary",onClick:a[6]||(a[6]=()=>{var e;return(e=B.value)==null?void 0:e.open()})},{icon:o(()=>[n(k,{name:"PlusOutlined"})]),default:o(()=>[m(" \u65B0\u5EFA ")]),_:1})):v("",!0),g(p).delete?(r(),f(R,{key:2,title:"\u60A8\u786E\u5B9A\u8981\u5220\u9664?",onConfirm:a[7]||(a[7]=e=>A()),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"},{default:o(()=>[n(_,{type:"primary",danger:""},{icon:o(()=>[n(k,{name:"DeleteOutlined"})]),default:o(()=>[m(" \u6279\u91CF\u5220\u9664 ")]),_:1})]),_:1})):v("",!0),s.$props.isFindBack?(r(),f(_,{key:3,type:"primary",onClick:a[8]||(a[8]=e=>x.onChange())},{icon:o(()=>[n(k,{name:"CheckOutlined"})]),default:o(()=>[m(" \u5E26\u56DE\u6570\u636E ")]),_:1})):v("",!0)]),"toolbar-right":o(()=>[n(G,null,{overlay:o(()=>[n(P,null,{default:o(()=>[n(H,{key:"1",onClick:a[9]||(a[9]=e=>V())},{default:o(()=>[m("\u5BFC\u51FA Excel")]),_:1})]),_:1})]),default:o(()=>[n(_,null,{default:o(()=>[m(" \u66F4\u591A "),n(k,{name:"ellipsis-outlined"})]),_:1})]),_:1}),n(Q,null,{content:o(()=>[(r(!0),w(O,null,N(t.columns.filter(e=>e.fieldName.substr(0,1)!="_"),e=>(r(),w("div",null,[n(J,{checked:e.show,"onUpdate:checked":l=>e.show=l},{default:o(()=>[m(ae(e.title),1)]),_:2},1032,["checked","onUpdate:checked"])]))),256))]),default:o(()=>[n(_,{type:"text"},{icon:o(()=>[n(k,{name:"setting-outlined"})]),_:1})]),_:1})]),"table-col":o(()=>[(r(!0),w(O,null,N(t.columns.filter(e=>e.fieldName!=="id"&&e.show),(e,l)=>(r(),f(I,{key:e.fieldName,title:e.title,"data-index":e.fieldName,sorter:e.sort?{multiple:l+1}:!1},null,8,["title","data-index","sorter"]))),128)),g(p).update||g(p).delete?(r(),f(I,{key:0,title:"\u64CD\u4F5C","data-index":"id"},{default:o(({record:e})=>[g(p).update?(r(),w("a",{key:0,href:"javascript:;",onClick:()=>{var l;return(l=B.value)==null?void 0:l.open(e.id)}},"\u7F16\u8F91",8,de)):v("",!0),n(W,{type:"vertical"}),g(p).delete?(r(),f(R,{key:1,title:"\u60A8\u786E\u5B9A\u8981\u5220\u9664?",onConfirm:l=>A(e.id),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"},{default:o(()=>[ce]),_:2},1032,["onConfirm"])):v("",!0)]),_:1})):v("",!0)]),_:1},8,["config"]),n(ne,{ref_key:"refInfo",ref:B,onSuccess:()=>y()},null,8,["onSuccess"])]),_:1},8,["show"])}}});export{ke as _};
